<div class="card">
  <div class="card-header">
    <h5 class="card-title">Change Password</h5>
  </div>
  <div class="card-body">
    <form [formGroup]="changePasswordForm" (ngSubmit)="onChangePassword()">
      <div class="form-group mb-3">
        <label for="currentPassword">Current Password</label>
        <input type="password" id="currentPassword" formControlName="currentPassword" class="form-control"
          [ngClass]="{ 'is-invalid': changePasswordForm.get('currentPassword')?.invalid && changePasswordForm.get('currentPassword')?.touched }">
        <div class="invalid-feedback"
          *ngIf="changePasswordForm.get('currentPassword')?.invalid && changePasswordForm.get('currentPassword')?.touched">
          Current password is required.
        </div>
      </div>

      <div class="form-group mb-3">
        <label for="newPassword">New Password</label>
        <input type="password" id="newPassword" formControlName="newPassword" class="form-control"
          [ngClass]="{ 'is-invalid': newPasswordControl?.invalid && newPasswordControl?.touched }">
        <div class="invalid-feedback"
          *ngIf="newPasswordControl?.invalid && newPasswordControl?.touched">
          <div *ngIf="newPasswordControl?.errors?.['required']">New password is required.</div>
          <div *ngIf="newPasswordControl?.errors?.['passwordStrength']">
            Password must meet the following criteria:
            <ul>
              <li [class.text-success]="newPasswordControl?.errors?.['hasMinLength']">At least 8 characters</li>
              <li [class.text-success]="newPasswordControl?.errors?.['hasUpperCase']">At least one uppercase letter</li>
              <li [class.text-success]="newPasswordControl?.errors?.['hasLowerCase']">At least one lowercase letter</li>
              <li [class.text-success]="newPasswordControl?.errors?.['hasDigit']">At least one digit</li>
              <li [class.text-success]="newPasswordControl?.errors?.['hasSpecialChar']">At least one special character</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="form-group mb-3">
        <label for="confirmNewPassword">Confirm New Password</label>
        <input type="password" id="confirmNewPassword" formControlName="confirmNewPassword" class="form-control"
          [ngClass]="{ 'is-invalid': confirmNewPasswordControl?.invalid && confirmNewPasswordControl?.touched || changePasswordForm.errors?.['passwordsMismatch'] }">
        <div class="invalid-feedback"
          *ngIf="confirmNewPasswordControl?.invalid && confirmNewPasswordControl?.touched">
          Confirm new password is required.
        </div>
        <div class="invalid-feedback"
          *ngIf="changePasswordForm.errors?.['passwordsMismatch'] && confirmNewPasswordControl?.touched">
          New password and confirmation do not match.
        </div>
      </div>

      <button type="submit" class="btn btn-primary" [disabled]="changePasswordForm.invalid || loading">
        {{ loading ? 'Changing...' : 'Change Password' }}
      </button>
    </form>
  </div>
</div>