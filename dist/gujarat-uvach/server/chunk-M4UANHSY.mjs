import './polyfills.server.mjs';
import{a as Ae,b as $e}from"./chunk-4DXIMVEH.mjs";import{a as Ve,b as Le}from"./chunk-ZJL2KSE7.mjs";import{b as Ne}from"./chunk-PMYHEKMD.mjs";import{a as xe,b as ye,d as _e}from"./chunk-FO4EYZVR.mjs";import{b as Ce,d as Fe}from"./chunk-FPJP6Y6T.mjs";import"./chunk-TV64742C.mjs";import{b as we,f as be}from"./chunk-25AQEAWR.mjs";import{a as Me,d as Ee,e as ke,f as Te,g as Ie}from"./chunk-7ZEVCGT6.mjs";import"./chunk-BHC33PMZ.mjs";import{A as ge,B as ve,C as Se,e as me,h as he,m as fe,q as ue}from"./chunk-U6GZNWZS.mjs";import"./chunk-BPJ7ZZQW.mjs";import{A as H,h as ce,v as de}from"./chunk-VQU2SKIF.mjs";import{$b as y,Bc as ae,Cc as se,Cd as pe,Da as ee,Ea as w,Fa as b,Fb as x,Ga as $,Gb as ie,Ha as V,Hb as d,Ma as L,Sb as a,Tb as l,U as k,Ub as F,Yb as D,bc as S,gb as te,ka as Z,la as J,mb as c,mc as f,nb as v,nc as re,oc as oe,rd as O,sd as B,tb as U,ua as K,v as E,va as A,wa as Q,wc as ne,xa as Y,yd as le}from"./chunk-SNHROY6X.mjs";import{h as z}from"./chunk-VVCT4QZE.mjs";function Ge(r,g){r&1&&(a(0,"mat-error"),f(1," Please select an SVG file. "),l())}function Pe(r,g){if(r&1&&(a(0,"mat-error",19),f(1),l()),r&2){let e=S();c(),re(e.errorMessage)}}function qe(r,g){r&1&&F(0,"mat-progress-spinner",20)}function ze(r,g){r&1&&(a(0,"span"),f(1,"Upload"),l())}function He(r,g){if(r&1){let e=D();a(0,"div",25)(1,"div",26),$(),F(2,"svg",27),l(),V(),a(3,"div",28)(4,"div",29)(5,"mat-checkbox",30),y("change",function(i){let o=w(e).$implicit,n=S(2);return b(n.onToggleMergeSelection(o.id,i.checked))}),l(),a(6,"button",31),y("click",function(){let i=w(e).$implicit,o=S(2);return b(o.deleteShape(i.id))}),a(7,"mat-icon"),f(8,"delete"),l()()()()()}if(r&2){let e=g.$implicit,t=S(2);c(2),d("drawSVG",e),c(3),d("value",e.id)("checked",t.mergeSelection.includes(e.id))}}function We(r,g){if(r&1&&(a(0,"div",21)(1,"div",22)(2,"div",23),x(3,He,9,3,"div",24),l()()()),r&2){let e=S();c(3),d("ngForOf",e.extractedShapes)}}var W=(()=>{class r{constructor(e,t,i){this.fb=e,this.renderer=t,this.host=i,this.uploading=!1,this.errorMessage=null,this.extractedShapes=[],this.mergeSelection=[],this.uploadForm=this.fb.group({file:[null,me.required]})}onFileSelected(e){let t=e.target;t.files?.length&&this.uploadForm.patchValue({file:t.files[0]})}onUpload(){return z(this,null,function*(){if(!this.uploadForm.invalid){this.uploading=!0,this.errorMessage=null;try{let e=this.uploadForm.get("file").value;this.extractedShapes=yield this.getAllShapes(e)}catch(e){console.error(e),this.errorMessage="Upload failed"}finally{this.uploading=!1}}})}deleteShape(e){this.extractedShapes=this.extractedShapes.filter(t=>t.id!==e)}mergeShapes(){if(this.mergeSelection.length<2){console.warn("Select at least two shapes to merge");return}let e=this.mergeSelection.map(t=>this.extractedShapes.find(i=>i.id===t)?.rawSvg).filter(Boolean).join("");this.extractedShapes=this.extractedShapes.filter(t=>!this.mergeSelection.includes(t.id)),this.extractedShapes.push({id:Date.now().toString(),rawSvg:`<g>${e}</g>`,type:"g",viewBox:this.extractedShapes[0]?.viewBox??"0 0 0 0",selected:!1,data:{}}),this.mergeSelection=[]}getAllShapes(e){return z(this,null,function*(){let t=yield e.text(),n=new DOMParser().parseFromString(t,"image/svg+xml").querySelector("svg");this.inlineSvgStyles(n);let h=Array.from(n.querySelectorAll("rect, circle, ellipse, line, polyline, polygon, path")).filter(m=>m.hasAttribute("fill")),p=this.renderer.createElement("div");this.renderer.setStyle(p,"position","absolute"),this.renderer.setStyle(p,"visibility","hidden"),this.renderer.appendChild(this.host.nativeElement,p);let u=this.renderer.createElement("svg","svg");this.renderer.appendChild(p,u);let R=h.map((m,G)=>{let P=m.cloneNode(!0);this.renderer.appendChild(u,P);let T=P.getBBox();this.renderer.removeChild(u,P);let I=Number(m.getAttribute("stroke-width")||0)+2,Be={x:T.x-I,y:T.y-I,width:T.width+I*2,height:T.height+I*2},X=m.tagName.toLowerCase(),_={},N=m.getAttribute("fill");if(/^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/.test(N))_.fill=N;else if(/^rgb\(/.test(N)){let[C,M,je]=N.match(/\d+/g).map(q=>parseInt(q,10));_.fill="#"+[C,M,je].map(q=>q.toString(16).padStart(2,"0")).join("")}else _.fill="none";return m.hasAttribute("stroke")&&(_.stroke=m.getAttribute("stroke")),m.hasAttribute("stroke-width")&&(_.strokeWidth=Number(m.getAttribute("stroke-width"))),X==="path"&&(_.d=m.getAttribute("d")||""),["x","y","width","height","cx","cy","r","rx","ry","x1","y1","x2","y2","points"].forEach(C=>{if(m.hasAttribute(C)){let M=m.getAttribute(C);_[C]=isNaN(Number(M))?M:Number(M)}}),{id:G.toString(),rawSvg:m.outerHTML,type:X,viewBox:this.normalizeToSquare(Be),selected:!1,data:_}});return this.renderer.removeChild(this.host.nativeElement,p),R})}normalizeToSquare(e){let{x:t,y:i,width:o,height:n}=e,s=Math.max(o,n),h=(s-o)/2,p=(s-n)/2;return`${t-h} ${i-p} ${s} ${s}`}inlineSvgStyles(e){let t=e.querySelector("style");if(!t)return;let i=new CSSStyleSheet;i.replaceSync(t.textContent||"");for(let o of Array.from(i.cssRules)){if(!(o instanceof CSSStyleRule))continue;let n=Array.from(e.querySelectorAll(o.selectorText));for(let s of n){let h=o.style;for(let p=0;p<h.length;p++){let u=h.item(p);s.hasAttribute(u)||s.setAttribute(u,h.getPropertyValue(u).trim())}}}t.remove()}onToggleMergeSelection(e,t){t?this.mergeSelection.push(e):this.mergeSelection=this.mergeSelection.filter(i=>i!==e)}static{this.\u0275fac=function(t){return new(t||r)(v(ge),v(U),v(L))}}static{this.\u0275cmp=A({type:r,selectors:[["app-upload-shape"]],decls:25,vars:8,consts:[[1,"position-absolute","h-100","w-100"],[1,"container-fluid","h-100","bg-light","py-3"],[1,"h-100","d-flex","flex-column","gap-3"],[1,""],[1,"border-0","shadow-sm","p-3"],[3,"ngSubmit","formGroup"],[1,"file-input-container","w-100","mb-3"],[1,"mat-form-field","appearance-fill","w-100"],[1,"mat-form-field-label"],["type","file","accept",".svg",3,"change"],[4,"ngIf"],["class","mt-3",4,"ngIf"],[1,"d-flex","align-items-center","gap-3","rounded-3"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20","mode","indeterminate",4,"ngIf"],["mat-raised-button","","color","success","type","button",3,"click","disabled"],[1,"h-100","d-flex","flex-column","flex-grow-1","position-relative","p-3","bg-white","border","rounded-3","shadow-sm","overflow-y-auto"],[1,"position-sticky","top-0","z-1","bg-white","pb-3","m-0"],["class","flex-grow-1 position-relative",4,"ngIf"],[1,"mt-3"],["diameter","20","mode","indeterminate"],[1,"flex-grow-1","position-relative"],[1,"position-absolute","h-100","w-100","overflow-y-auto"],[1,"shape-grid"],["class","shape-item overflow-hidden",4,"ngFor","ngForOf"],[1,"shape-item","overflow-hidden"],[1,"preview"],[1,"w-100","h-auto",3,"drawSVG"],[1,"actions","d-flex","justify-content-between","align-items-center","flex-column","w-100"],[1,"d-flex","align-items-center","justify-content-between","bg-light","bg-opacity-25","w-100"],[3,"change","value","checked"],["mat-icon-button","","color","warn",3,"click"]],template:function(t,i){if(t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-card",4)(5,"mat-card-title"),f(6,"Upload SVG"),l(),a(7,"form",5),y("ngSubmit",function(){return i.onUpload()}),a(8,"div",6)(9,"label",7)(10,"span",8),f(11,"Choose SVG File"),l(),a(12,"input",9),y("change",function(n){return i.onFileSelected(n)}),l()(),x(13,Ge,2,0,"mat-error",10),l(),x(14,Pe,2,1,"mat-error",11),a(15,"div",12)(16,"button",13),x(17,qe,1,0,"mat-progress-spinner",14)(18,ze,2,0,"span",10),l(),a(19,"button",15),y("click",function(){return i.mergeShapes()}),f(20," Merge "),l()()()()(),a(21,"div",16)(22,"h4",17),f(23,"Extracted Shapes"),l(),x(24,We,4,1,"div",18),l()()()()),t&2){let o;c(7),d("formGroup",i.uploadForm),c(6),d("ngIf",((o=i.uploadForm.get("file"))==null?null:o.invalid)&&((o=i.uploadForm.get("file"))==null?null:o.touched)),c(),d("ngIf",i.errorMessage),c(2),d("disabled",i.uploading||i.uploadForm.invalid),c(),d("ngIf",i.uploading),c(),d("ngIf",!i.uploading),c(),d("disabled",i.mergeSelection.length<2),c(5),d("ngIf",i.extractedShapes.length)}},styles:[".shape-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:16px}.shape-item[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.12);border-radius:8px;background:#fafafa}.preview[_ngcontent-%COMP%]{width:100%;height:100px;overflow:hidden;display:flex;align-items:center;justify-content:center;padding:8px}.preview[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{max-width:100%;max-height:100%}"]})}}return r})();var Ue=(()=>{class r{constructor(){this.files=new Map,this.fileCounter=1,this.shapeCounter=1}uploadSvg(e){let t=`${this.fileCounter++}`,i=Array.from({length:4}).map(()=>({id:`${this.shapeCounter++}`,svgContent:'<path d="M0,0 L50,0 L50,50 L0,50 Z" fill="none" stroke="black"/>',bbox:{x:0,y:0,width:50,height:50},selected:!1}));return this.files.set(t,i),E({fileId:t}).pipe(k(500))}listSvgFiles(){let e=Array.from(this.files.keys()).map(t=>({fileId:t,filename:`dummy-${t}.svg`}));return E(e).pipe(k(200))}getShapes(e){let t=this.files.get(e)||[];return E({shapes:t}).pipe(k(300))}selectShape(e,t){for(let i of this.files.values()){let o=i.find(n=>n.id===e);if(o){o.selected=t;break}}return E({success:!0}).pipe(k(100))}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=Z({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function Je(r,g){r&1&&(a(0,"div",5),f(1," Loading shapes\u2026 "),l())}function Ke(r,g){if(r&1&&(a(0,"div",6),f(1),l()),r&2){let e=S();c(),oe(" ",e.error," ")}}function Qe(r,g){if(r&1){let e=D();a(0,"div",7),y("click",function(){let i=w(e).$implicit,o=S();return b(o.toggleSelect(i))}),a(1,"div",8),$(),F(2,"svg",9),V(),a(3,"input",10),y("click",function(i){let o=w(e).$implicit,n=S();return i.stopPropagation(),b(n.toggleSelect(o))}),l()()()}if(r&2){let e=g.$implicit;c(2),d("innerHTML",e.rawSvg,te),ie("viewBox",e.viewBox),c(),d("checked",e.selected)}}var De=(()=>{class r{constructor(e,t){this.route=e,this.svgService=t,this.loading=!1,this.error=null}ngOnInit(){}normalizeToSquare(e){let{x:t,y:i,width:o,height:n}=e;if(o===n)return`${t} ${i} ${o} ${n}`;let s=Math.max(o,n),h=(s-o)/2,p=(s-n)/2;return`${t-h} ${i-p} ${s} ${s}`}toggleSelect(e){let t=!e.selected;this.svgService.selectShape(e.id,t).subscribe(()=>e.selected=t,i=>console.error("Selection update failed",i))}static{this.\u0275fac=function(t){return new(t||r)(v(de),v(Ue))}}static{this.\u0275cmp=A({type:r,selectors:[["app-shape-list"]],decls:8,vars:5,consts:[[1,"shape-list-container","p-4"],["class","text-center my-4",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"shape-grid","row","row-cols-2","row-cols-md-4","g-3"],["class","col",3,"click",4,"ngFor","ngForOf"],[1,"text-center","my-4"],[1,"alert","alert-danger"],[1,"col",3,"click"],[1,"shape-item","border","rounded","position-relative"],[1,"w-100","h-auto","d-block",3,"innerHTML"],["type","checkbox",1,"position-absolute","top-0","end-0","m-2",3,"click","checked"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"h2"),f(2,"Shape List"),l(),x(3,Je,2,0,"div",1)(4,Ke,2,1,"div",2),a(5,"div",3),x(6,Qe,4,3,"div",4),ae(7,"async"),l()()),t&2&&(c(3),d("ngIf",i.loading),c(),d("ngIf",i.error),c(2),d("ngForOf",se(7,3,i.shapes$)))},dependencies:[O,B,le]})}}return r})();var Oe=(()=>{class r{constructor(e,t){this.el=e,this.renderer=t}ngOnChanges(e){if(e.shape&&this.shape){let t=this.el.nativeElement;for(;t.firstChild;)t.removeChild(t.firstChild);let n=new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg">${this.shape.rawSvg}</svg>`,"image/svg+xml").querySelector("svg");if(!n)return;Array.from(n.childNodes).forEach(s=>{this.appendNodeRecursively(s,t)}),requestAnimationFrame(()=>{let s=t.getBBox(),h=2,p={x:s.x-h,y:s.y-h,width:s.width+h*2,height:s.height+h*2},u=Math.max(p.width,p.height),R=(u-p.width)/2,m=(u-p.height)/2,G=`${p.x-R} ${p.y-m} ${u} ${u}`;this.renderer.setAttribute(t,"viewBox",G)})}}appendNodeRecursively(e,t){if(e.nodeType===Node.ELEMENT_NODE){let i=e,o=this.renderer.createElement(i.tagName,"svg");for(let n=0;n<i.attributes.length;n++){let s=i.attributes[n];this.renderer.setAttribute(o,s.name,s.value)}i.childNodes.forEach(n=>{this.appendNodeRecursively(n,o)}),this.renderer.appendChild(t,o)}else if(e.nodeType===Node.TEXT_NODE&&e.textContent?.trim()){let i=this.renderer.createText(e.textContent);this.renderer.appendChild(t,i)}}static{this.\u0275fac=function(t){return new(t||r)(v(L),v(U))}}static{this.\u0275dir=Y({type:r,selectors:[["","drawSVG",""]],inputs:{shape:[K.None,"drawSVG","shape"]},features:[ee]})}}return r})();var Ye=[{path:"",component:De},{path:"upload",component:W}],Nt=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=Q({type:r})}static{this.\u0275inj=J({imports:[pe,ve,Se,ce,H.forChild(Ye),_e,be,Ce,ke,$e,Fe,Ie,Ne,Le,H]})}}return r})();ne(W,function(){return[O,B,fe,he,ue,xe,ye,we,Me,Ee,Ae,Te,Ve,Oe]},[]);export{Nt as ShapeManagerModule};
