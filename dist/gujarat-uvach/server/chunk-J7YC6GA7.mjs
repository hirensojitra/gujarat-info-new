import './polyfills.server.mjs';
import{a as ae}from"./chunk-Y2OBR2D5.mjs";import{a as se,b as le,c as de,k as me}from"./chunk-RFXR2AZK.mjs";import"./chunk-BLKWBMN4.mjs";import{a as ne}from"./chunk-KMC6O6YC.mjs";import"./chunk-IKPEBCM7.mjs";import{b as K,c as y,e as Q,f as X,j as Y,k as ee,l as te,q as ie,r as re,s as oe}from"./chunk-PXE2FO54.mjs";import{b as J}from"./chunk-662JNBOM.mjs";import{a as W}from"./chunk-BHXUZULZ.mjs";import{$ as P,B as p,C as h,Ca as z,D as k,Da as _,E as U,H as T,Hb as q,Kb as Z,Mb as E,R as S,T as l,U as f,X as N,_ as w,aa as u,ab as B,bb as H,cb as G,da as V,ga as n,gb as O,ha as r,ia as s,ja as j,ka as R,la as x,ma as c,na as g,oa as A,q as v,ua as d,va as D,w as M,wa as L,x as C,xa as $}from"./chunk-GKTD5S5R.mjs";import{h as b}from"./chunk-VVCT4QZE.mjs";var fe=()=>[30,50,100],be=o=>({"bg-dark text-white":o}),_e=o=>({"bg-opacity-25":o}),Fe=o=>({"active pe-none text-white":o}),Ie=o=>({"text-white":o});function ve(o,F){if(o&1){let e=x();n(0,"li",28)(1,"div",29)(2,"div",30)(3,"div",31)(4,"div",32),k(),n(5,"svg",33),s(6,"rect",34)(7,"path",35)(8,"path",36)(9,"path",37),r()(),U(),n(10,"div")(11,"p",38)(12,"a",39),c("click",function(){let i=p(e).$implicit;return g().fetchImages(i.id),h(!1)}),d(13),r()(),n(14,"span",40),d(15),r()(),n(16,"div",41)(17,"div",42)(18,"a",43),s(19,"i",44),r(),n(20,"ul",45)(21,"li")(22,"a",46),c("click",function(){let i=p(e).$implicit;return g().openFolderDeleteModal(i.id,i.name),h(!1)}),s(23,"i",47),d(24,"Delete"),r()(),n(25,"li")(26,"a",46),c("click",function(){let i=p(e).$implicit;return g().openRenameFolderModal(i.id),h(!1)}),s(27,"i",48),d(28,"Rename"),r()(),n(29,"li")(30,"a",46),c("click",function(){return p(e),h(!1)}),s(31,"i",49),d(32,"Hide Folder"),r()()()()()(),n(33,"div")(34,"div",50),s(35,"div",51),r()()()()()}if(o&2){let e=F.$implicit,t=g();l(),u("ngClass",_(10,be,t.selectedFolderId==e.id)),l(3),u("ngClass",_(12,_e,t.selectedFolderId==e.id)),l(8),u("ngClass",_(14,Fe,t.selectedFolderId==e.id)),l(),D(e.name),l(2),L("",t.imageCounts[e.id]," Files"),l(4),u("ngClass",_(16,Ie,t.selectedFolderId==e.id)),l(16),V("width: "+t.imageCounts[e.id]+"%"),P("aria-valuenow",t.imageCounts[e.id])("aria-label","Image Folder capacity: "+t.imageCounts[e.id]+"%")}}function Ce(o,F){if(o&1){let e=x();n(0,"li",61)(1,"div",62)(2,"div",63),s(3,"img",64),r(),n(4,"div",65)(5,"div",66)(6,"button",67),c("click",function(){let i=p(e).$implicit,a=g(2);return h(a.refreshImage(i.id,a.selectedFolderId))}),s(7,"i",68),r()(),n(8,"div",66)(9,"a",69),c("click",function(i){let a=p(e).$implicit,m=g(2);return h(m.copyHrefToClipboard(i,m.getImagePath(a)))}),s(10,"i",70),d(11," Copy"),r()(),n(12,"div",66)(13,"button",71),c("click",function(){let i=p(e).$implicit,a=g(2);return h(a.deleteImage(a.selectedFolderId,i.id))}),s(14,"i",72),r()()()()()}if(o&2){let e=F.$implicit,t=g(2);l(3),u("src",t.apiUrl+"/user-img"+t.getImagePath(e)+"?quality=30",S),l(6),A("href",t.getImagePath(e),S)}}function we(o,F){if(o&1){let e=x();j(0),n(1,"div",52)(2,"div",53)(3,"h6",54),d(4),r(),n(5,"div",55)(6,"label",56),s(7,"i",57),d(8,"Upload Image"),r(),n(9,"input",58),c("change",function(i){p(e);let a=g();return h(a.onFileSelected(i))}),r()()(),n(10,"div",30)(11,"ul",59),w(12,Ce,15,2,"li",60),r()()(),R()}if(o&2){let e=g();l(4),$("",e.selectedFolderName,"(",e.imageCounts[e.selectedFolderId],")"),l(8),u("ngForOf",e.images)}}var ue=(()=>{class o{onFolderPageChange(e){return b(this,null,function*(){this.folderPage!==e&&(this.folderPage=e,this.fetchFolders())})}onFolderPageSizeChange(e){return b(this,null,function*(){this.folderLimit!==e&&(this.folderLimit=e,this.folderPage=1,this.fetchFolders())})}constructor(e,t,i,a,m,I,pe,he){this.userImageService=e,this.formBuilder=t,this.toast=i,this.elementRef=a,this.renderer=m,this.router=I,this.route=pe,this.userService=he,this.userId="",this.folders=[],this.images=[],this.selectedFile=null,this.selectedFolderId=null,this.selectedFolderName="",this.apiUrl=W.MasterApi,this.confirmationMessage="",this.confirmationTitle="",this.imagePage=1,this.imageLimit=10,this.imageItems=0,this.totalImagePages=1,this.folderPage=1,this.folderItems=0,this.folderLimit=30,this.searchFolder="",this.imageCounts={},this.initializeForms()}ngOnInit(){return b(this,null,function*(){})}ngAfterViewInit(){return b(this,null,function*(){yield this.userService.getUser().subscribe(e=>b(this,null,function*(){this.userId!==e.id&&(this.userId=e.id,yield this.loadFolderCount(),yield this.fetchFolders())})),this.route.queryParams.subscribe(e=>{let t=e.folder;t&&this.fetchImages(t)})})}initializeForms(){this.addFolderForm=this.formBuilder.group({folderName:["",y.required]}),this.renameFolderForm=this.formBuilder.group({folderName:["",y.required],folderId:["",y.required]})}fetchFolders(){let e=this.searchFolder.trim(),t=this.sortFolderBy||"created_at",i=this.sortFolderOrder||"asc";this.folderLimit&&this.userImageService.getFolders(this.userId,this.folderPage,this.folderLimit,e,t,i).subscribe({next:a=>{this.folders=a.folders},error:()=>{this.toast.show("Error fetching folders!",{class:"bg-danger"})}})}onFileSelected(e){let t=e.target;t.files&&t.files[0]&&(this.selectedFile=t.files[0],this.selectedFolderId&&this.uploadImage(this.selectedFolderId))}uploadImage(e){if(this.selectedFile&&e){let t={description:"Sample Image"};this.userImageService.uploadImage(this.userId,e,this.selectedFile,t).subscribe({next:()=>{this.fetchImages(e),this.loadFolderCount()},error:()=>this.toast.show("Error uploading image!",{class:"bg-danger"})})}}fetchImages(e,t=1,i=10){this.userImageService.getImagesInFolder(this.userId,e,t,i).subscribe({next:a=>{this.images=a.images,this.selectedFolderId=e,this.selectedFolderName=this.folders.find(m=>m.id===e)?.name||"",this.loadImageCount(e),this.router.navigate([],{relativeTo:this.route,queryParams:{folder:e},queryParamsHandling:"merge"})},error:()=>{this.toast.show("Error fetching images!",{class:"bg-danger"})}})}deleteImage(e,t){this.userImageService.deleteImage(this.userId,e,t).subscribe({next:()=>{this.fetchImages(e)},error:()=>this.toast.show("Error deleting image!",{class:"bg-danger"})})}openAddFolderModal(){new bootstrap.Modal(document.getElementById("addFolderModal")).show()}openRenameFolderModal(e){let t=this.folders.find(i=>i.id===e);t&&(this.selectedFolderId=e,this.renameFolderForm.patchValue({folderName:t.name,folderId:t.id}),new bootstrap.Modal(document.getElementById("renameFolderModal")).show())}addFolder(){if(this.addFolderForm.valid){let e=this.addFolderForm.value.folderName;this.userImageService.createFolder(this.userId,e).subscribe({next:()=>{this.fetchFolders(),this.addFolderForm.reset(),bootstrap.Modal.getInstance(document.getElementById("addFolderModal")).hide(),this.toast.show("Folder created successfully!",{class:"bg-success"}),this.loadFolderCount()},error:()=>{this.toast.show("Error creating folder!",{class:"bg-danger"})}})}}renameFolder(){if(this.renameFolderForm.valid){let e=this.renameFolderForm.value.folderName,t=this.renameFolderForm.value.folderId;this.userImageService.renameFolder(t,e).subscribe({next:()=>{this.fetchFolders(),this.toast.show("Folder renamed successfully!",{class:"bg-success"}),bootstrap.Modal.getInstance(document.getElementById("renameFolderModal")).hide()},error:()=>{this.toast.show("Error renaming folder!",{class:"bg-danger"})}})}}deleteFolder(){this.selectedFolderId!==null&&this.userImageService.deleteFolder(this.selectedFolderId).subscribe({next:()=>{this.toast.show("Folder deleted successfully!",{class:"bg-success"}),this.selectedFolderId=null,this.fetchFolders()},error:()=>{this.toast.show("Error deleting folder!",{class:"bg-danger"}),this.selectedFolderId=null}})}copyHrefToClipboard(e,t){e.preventDefault();let i=this.renderer.createElement("textarea");i.value=`${this.apiUrl}/user-img${t}`,this.renderer.appendChild(this.elementRef.nativeElement,i),i.select(),document.execCommand("copy"),this.renderer.removeChild(this.elementRef.nativeElement,i),this.toast.show("Image File path copied to clipboard",{title:"Copy Success",class:"bg-success"})}refreshImage(e,t){let i=document.createElement("input");i.type="file",i.accept="image/*",i.onchange=a=>{let m=a.target;if(m.files&&m.files.length>0){let I=new FormData;I.append("image",m.files[0]),this.userImageService.refreshImage(this.userId,t,e,I).subscribe({next:()=>{this.fetchImages(this.selectedFolderId),this.toast.show("Image replaced successfully!",{class:"bg-success"})},error:()=>{this.toast.show("Error replacing image!",{class:"bg-danger"})}})}},i.click()}openFolderDeleteModal(e,t){this.selectedFolderId=e,this.selectedFolderName=t,this.confirmationTitle="Confirm Folder Deletion",this.confirmationMessage=`Are you sure you want to delete the folder "${t}"? This action cannot be undone.`,new bootstrap.Modal(document.getElementById("confirmationModal")).show()}getImagePath(e){let t=e.image_url.split("/");return t.pop(),`${t.join("/")}/${e.id}`}loadFolderCount(e=""){this.userImageService.getTotalFolderCount(this.userId,e).subscribe({next:t=>{t&&typeof t.count=="number"?this.folderItems=t.count:console.warn("Unexpected response structure:",t)},error:t=>{console.error("Error fetching folder count:",t)},complete:()=>{}})}loadImageCount(e){return b(this,null,function*(){try{if(!this.imageCounts[e]){let t=yield this.userImageService.getTotalImageCount(e).toPromise();this.imageCounts[e]=t.totalCount}}catch(t){console.error("Error fetching image count",t),this.imageCounts[e]=0}})}static{this.\u0275fac=function(t){return new(t||o)(f(ae),f(ie),f(ne),f(T),f(N),f(Z),f(q),f(J))}}static{this.\u0275cmp=M({type:o,selectors:[["app-user-img"]],decls:47,vars:11,consts:[[1,"container"],[1,"btn","btn-success","btn-sm","my-2",3,"click"],[1,"fa","fa-plus","me-2"],[1,"row","g-2","list-unstyled"],["class","col-lg-3 col-md-4 col-sm-6 col-6",4,"ngFor","ngForOf"],["pagination","",3,"currentPageChange","pageSizeChange","currentPage","totalItems","pageSize","pageSizes"],[4,"ngIf"],["id","addFolderModal","tabindex","-1","aria-labelledby","addFolderModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","addFolderModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[3,"formGroup"],[1,"mb-3"],["for","folderName",1,"form-label"],["type","text","formControlName","folderName","id","folderName",1,"form-control"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary",3,"click"],["id","renameFolderModal","tabindex","-1","aria-labelledby","renameFolderModalLabel","aria-hidden","true",1,"modal","fade"],["id","renameFolderModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal",1,"btn","btn-sm","btn-outline-danger"],[1,"fa","fa-close","me-2"],["type","button",1,"btn","btn-sm","btn-success","text-white",3,"click"],[1,"fa","fa-save","me-2"],[3,"confirm","title","message"],[1,"col-lg-3","col-md-4","col-sm-6","col-6"],[1,"card","border","shadow-none",3,"ngClass"],[1,"card-body"],[1,"mb-0","folder-svg-container","d-flex","flex-wrap","align-items-center"],[1,"me-3","bg-lighter","avatar","avatar-lg","border","h-40-px","w-40-px","p-1","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 256 256"],["width","256","height","256","fill","none"],["d","M69.77,112H208V88a8,8,0,0,0-8-8H130.67a8,8,0,0,1-4.8-1.6L98.13,57.6a8,8,0,0,0-4.8-1.6H40a8,8,0,0,0-8,8V208l30.18-90.53A8,8,0,0,1,69.77,112Z","opacity","0.2"],["d","M32,208V64a8,8,0,0,1,8-8H93.33a8,8,0,0,1,4.8,1.6l27.74,20.8a8,8,0,0,0,4.8,1.6H200a8,8,0,0,1,8,8v24","fill","none","stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","16"],["d","M32,208l30.18-90.53A8,8,0,0,1,69.77,112H232a8,8,0,0,1,7.59,10.53L211.09,208Z","fill","none","stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","16"],[1,"fs-14","fw-medium","mb-1","lh-1"],["href","#",1,"link","fw-bold","text-decoration-none",3,"click","ngClass"],[1,"fs-12"],[1,"float-end","ms-auto"],[1,"dropdown"],["href","#","data-bs-toggle","dropdown","aria-expanded","false","aria-label","More Option",1,"btn","btn-flat","btn-sm"],[1,"fa","fa-ellipsis-v",3,"ngClass"],[1,"dropdown-menu","dropdown-menu-end","bg-dark","dropdown-menu-dark"],["href","#",1,"dropdown-item",3,"click"],[1,"w-20-px","text-center","fa","fa-trash","me-2","text-danger"],[1,"w-20-px","text-center","fa","fa-pencil","me-2","text-primary"],[1,"w-20-px","text-center","fa","fa-eye-slash","me-2","text-mute"],[1,"progress","progress-xs","mt-3"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-primary","progress-bar-striped"],[1,"card","shadow"],[1,"card-header","d-flex","align-items-center"],[1,"fw-bold","m-0"],[1,"ms-auto"],["for","uploadImage",1,"btn","btn-success","ms-2","btn-sm"],[1,"fa","fa-image","me-2"],["type","file","id","uploadImage",1,"d-none",3,"change"],[1,"row","g-3","list-unstyled","align-items-stretch"],["class","col-lg-3 col-md-4 col-sm-6 col-12",4,"ngFor","ngForOf"],[1,"col-lg-3","col-md-4","col-sm-6","col-12"],[1,"d-flex","h-100","flex-column","p-2","border","rounded","shadow-sm"],[1,"img-container","flex-grow-1","d-flex","align-items-end","mb-2"],["alt","Image",1,"img-fluid","rounded","m-auto",3,"src"],[1,"row","g-2"],[1,"col-4"],["aria-label","Replace",1,"btn","btn-sm","btn-outline-success","w-100",3,"click"],[1,"fa","fa-refresh"],["aria-label","Copy",1,"btn","btn-sm","btn-outline-dark","w-100",3,"click","href"],[1,"fa","fa-copy"],["aria-label","Delete",1,"btn","btn-sm","btn-outline-danger","w-100",3,"click"],[1,"fa","fa-trash"]],template:function(t,i){t&1&&(n(0,"div",0)(1,"button",1),c("click",function(){return i.openAddFolderModal()}),s(2,"i",2),d(3,"Add Folder "),r(),n(4,"ul",3),w(5,ve,36,18,"li",4),r(),n(6,"div",5),c("currentPageChange",function(m){return i.onFolderPageChange(m)})("pageSizeChange",function(m){return i.onFolderPageSizeChange(m)}),r(),w(7,we,13,3,"ng-container",6),r(),n(8,"div",7)(9,"div",8)(10,"div",9)(11,"div",10)(12,"h5",11),d(13,"Add Folder"),r(),s(14,"button",12),r(),n(15,"div",13)(16,"form",14)(17,"div",15)(18,"label",16),d(19,"Folder Name"),r(),s(20,"input",17),r()()(),n(21,"div",18)(22,"button",19),d(23,"Close"),r(),n(24,"button",20),c("click",function(){return i.addFolder()}),d(25,"Add Folder"),r()()()()(),n(26,"div",21)(27,"div",8)(28,"div",9)(29,"div",10)(30,"h5",22),d(31,"Rename Folder"),r(),s(32,"button",12),r(),n(33,"div",13)(34,"form",14)(35,"div",15)(36,"label",16),d(37,"Folder Name"),r(),s(38,"input",17),r()()(),n(39,"div",18)(40,"button",23),s(41,"i",24),d(42,"Cancel"),r(),n(43,"button",25),c("click",function(){return i.renameFolder()}),s(44,"i",26),d(45,"Save"),r()()()()(),n(46,"app-confirmation-modal",27),c("confirm",function(){return i.deleteFolder()}),r()),t&2&&(l(5),u("ngForOf",i.folders),l(),u("currentPage",i.folderPage)("totalItems",i.folderItems)("pageSize",i.folderLimit)("pageSizes",z(10,fe)),l(),u("ngIf",i.selectedFolderId),l(9),u("formGroup",i.addFolderForm),l(18),u("formGroup",i.renameFolderForm),l(12),u("title",i.confirmationTitle)("message",i.confirmationMessage))},dependencies:[B,H,G,se,le,de,Y,K,Q,X,ee,te]})}}return o})();var xe=[{path:"",component:ue,data:{title:"Images | Gujarat Uvach",description:"Welcome to the Gujarat Uvach dashboard. Access a variety of services and features designed to enhance your experience.",keywords:"Gujarat Uvach, services, dashboard, user portal, features, access",robots:"index, follow"}}],ge=(()=>{class o{static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275mod=C({type:o})}static{this.\u0275inj=v({imports:[E.forChild(xe),E]})}}return o})();var Ze=(()=>{class o{static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275mod=C({type:o})}static{this.\u0275inj=v({imports:[O,ge,me,re,oe]})}}return o})();export{Ze as UserImgModule};
