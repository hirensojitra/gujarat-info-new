import './polyfills.server.mjs';
import{a as r}from"./chunk-AJBY5M5H.mjs";import{a as u}from"./chunk-D7IAKCP3.mjs";import{a,b as n,c as p}from"./chunk-W6Z6YZO4.mjs";import{M as s,ga as l,h as c,la as o,u as h}from"./chunk-MA44MDZG.mjs";var y=(()=>{class i{constructor(e,t){this.http=e,this.cookieService=t,this.userSubject=new c(null),this.apiUrl=`${r.MasterApi}/auth`,this.cookieOptions={path:r.cookieConfig.path,secure:r.cookieConfig.secure,sameSite:r.cookieConfig.sameSite,httpOnly:r.cookieConfig.httpOnly},this.initializeUser()}initializeUser(){let e=this.cookieService.get("user");if(!e||e==="null"){this.clearUserData();return}try{let t=JSON.parse(e);t&&t.username?this.userSubject.next(t):this.clearUserData()}catch(t){console.error("Invalid user data in cookie:",t),this.clearUserData()}}getUser(){return this.userSubject.asObservable()}getFullName(){let e=this.userSubject.value;return e?`${e.firstname||""} ${e.lastname||""}`.trim():"User"}setUser(e){if(console.log(e),!e){this.clearUserData();return}this.cookieService.set("user",JSON.stringify(e),{path:"/",secure:!1}),this.cookieService.set("user",JSON.stringify(e),this.cookieOptions),this.userSubject.next(e)}getAllUsers(e={}){let t=new n({fromObject:{page:e.page?.toString()??"1",limit:e.limit?.toString()??"10",search:e.search??"",sortBy:e.sortBy??"created_at",order:e.order??"asc"}});return this.http.get(`${this.apiUrl}/users`,{headers:this.authHeaders,params:t}).pipe(s(this.handleError))}updateUser(e,t){return console.log(t),this.http.put(`${this.apiUrl}/updateUser/${e}`,t,{headers:this.authHeaders}).pipe(s(this.handleError))}verifyEmail(e,t){let m=new n().set("token",e).set("email",t);return this.http.get(`${this.apiUrl}/verify-email`,{headers:this.authHeaders,params:m}).pipe(s(this.handleError))}registerUser(e){return this.http.post(`${this.apiUrl}/register`,e).pipe(s(this.handleError))}get authHeaders(){let e=this.cookieService.get("token");return e?new a({Authorization:`Bearer ${e}`}):new a}clearUserData(){this.cookieService.delete("user",this.cookieOptions.path),this.userSubject.next(null)}handleError(e){console.error("API Error:",e);let t=e.error?.message||"User operation failed";return h(()=>new Error(t))}static{this.\u0275fac=function(t){return new(t||i)(o(p),o(u))}}static{this.\u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{y as a};
