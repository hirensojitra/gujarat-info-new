import './polyfills.server.mjs';
import{a as fe}from"./chunk-5ERTPICF.mjs";import{a as ae}from"./chunk-DFGCTN33.mjs";import{a as oe}from"./chunk-VLP3E6X3.mjs";import"./chunk-FW4VF2IF.mjs";import"./chunk-6XMGVEEK.mjs";import"./chunk-7HDQKCIK.mjs";import{i as ue,n as he}from"./chunk-ESZV63HH.mjs";import"./chunk-B63K4NSQ.mjs";import{a as re}from"./chunk-AJBY5M5H.mjs";import{B as ge,c as se,g as le,l as me,u as ce,v as de,w as pe}from"./chunk-U6GZNWZS.mjs";import{A as z,v as te,y as ie,z as ne}from"./chunk-VQU2SKIF.mjs";import{$b as _,B as y,Bc as v,Cc as C,Cd as Z,Ea as c,Ed as ee,Fa as d,Fb as S,Hb as h,Sa as F,Sb as o,Tb as s,Tc as Y,Ub as b,Vb as k,Wb as $,Yb as I,aa as j,bc as f,ca as N,da as M,ea as B,g as R,ga as T,hb as W,ic as O,jc as q,kc as G,la as L,mb as l,mc as p,nb as u,oc as Q,rc as x,rd as J,sc as V,sd as K,tb as U,tc as E,va as A,wa as P,xc as H,yd as X}from"./chunk-SNHROY6X.mjs";import{a as D}from"./chunk-VVCT4QZE.mjs";var Se=["masonryGrid"],Ie=()=>[10,20,30];function Me(n,w){if(n&1){let i=I();o(0,"a",28),_("click",function(){c(i);let t=f().$implicit;return f().navigateToEdit(t.id),d(!1)}),b(1,"i",29),p(2,"Edit "),s()}}function Le(n,w){if(n&1){let i=I();o(0,"div",19)(1,"div",20)(2,"div",21)(3,"img",22),_("load",function(t){c(i);let r=f();return d(r.onSvgLoad(t))}),s(),o(4,"div",23),S(5,Me,3,0,"a",24),v(6,"async"),o(7,"a",25),b(8,"i",26),p(9,"View "),s()(),o(10,"span",27),p(11),s()()()()}if(n&2){let i=w.$implicit,e=f();l(3),h("src",e.imgUrl+i.id,W)("alt",i.title),l(2),h("ngIf",C(6,5,e.isAdmin$)),l(2),h("routerLink","/poster/"+i.id),l(4),Q(" Download: ",i.download_counter," ")}}function Pe(n,w){n&1&&(o(0,"div",30)(1,"p"),p(2,"No images found."),s()())}function be(n,w){if(n&1){let i=I();k(0),o(1,"div",31),_("currentPageChange",function(t){c(i);let r=f();return d(r.changePage(t))})("pageSizeChange",function(t){c(i);let r=f();return d(r.changePageSize(t))}),s(),$()}if(n&2){let i=w.ngIf,e=f();l(),h("currentPage",i.currentPage)("totalItems",i.totalPosts)("pageSize",e.limit)("pageSizes",H(4,Ie))}}var ye=(()=>{class n{constructor(i,e,t,r,g,a,Ce,we){this.route=i,this.router=e,this.postSvc=t,this.authSvc=r,this.roleSvc=g,this.platformId=a,this.cdr=Ce,this.renderer=we,this.search="",this.sortBy="created_at",this.order="desc",this.limit=12,this.imgUrl=`${re.MasterApi}/thumb-images/`,this.destroy$=new R,this.currentPage=1,this.pageSizes=[12,24,48],this.params$=this.route.queryParams.pipe(y(m=>({page:+m.page||1,limit:+m.limit||this.limit,search:m.search||this.search,sortBy:m.sortBy||this.sortBy,order:m.order||this.order})),T(m=>{this.currentPage=m.page,this.search=m.search,this.sortBy=m.sortBy,this.order=m.order,this.limit=m.limit}),B(this.destroy$)),this.isBrowser=ee(a)}ngOnInit(){this.isAdmin$=this.authSvc.user$.pipe(M(e=>e?this.roleSvc.getRoleById(e.role_id).pipe(y(t=>["owner","administrator"].includes(t?.code.toLowerCase()??""))):[!1]),B(this.destroy$));let i=this.params$.pipe(M(({page:e,limit:t,search:r,sortBy:g,order:a})=>this.postSvc.getMinimalPosts({page:e,limit:t,search:r,sortBy:g,order:a})),T(()=>this.cdr.markForCheck()),j({bufferSize:1,refCount:!0}));this.posts$=i.pipe(y(e=>e.posts.map(t=>D({},t)))),this.pagination$=i.pipe(y(e=>e.pagination)),this.loading$=this.params$.pipe(M(()=>i.pipe(y(()=>!1),N(!0))))}ngAfterViewInit(){this.isBrowser&&(this.initMasonry(),window.addEventListener("resize",this.initMasonry))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),window.removeEventListener("resize",this.initMasonry)}changePage(i){i!==this.currentPage&&(this.currentPage=i,this.updateUrl())}changePageSize(i){i!==this.limit&&(this.limit=i,this.currentPage=1,this.updateUrl())}updateUrl(){this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.currentPage,limit:this.limit,search:this.search,sortBy:this.sortBy,order:this.order},queryParamsHandling:"merge"})}navigateToEdit(i){let e={queryParams:{img:i}},t=this.router.createUrlTree(["/images/post-generate"],e);window.open(this.router.serializeUrl(t),"_blank")}onSvgLoad(i){let e=i.target.parentElement;e&&(this.renderer.removeClass(e,"opacity-0"),this.initMasonry(),console.log("SVG loaded"))}initMasonry(){this.masonryInstance=new Masonry(this.masonryGridRef.nativeElement,{itemSelector:".masonry-box",percentPosition:!0})}static{this.\u0275fac=function(e){return new(e||n)(u(te),u(ie),u(fe),u(oe),u(ae),u(F),u(Y),u(U))}}static{this.\u0275cmp=A({type:n,selectors:[["app-image-list"]],viewQuery:function(e,t){if(e&1&&O(Se,7),e&2){let r;q(r=G())&&(t.masonryGridRef=r.first)}},decls:31,vars:15,consts:[["masonryGrid",""],[1,"position-absolute","h-100","w-100","d-flex","overflow-auto","flex-column"],[1,"container","h-100","w-100"],[1,"row","g-3"],[1,"col-6","pb-3"],["target","_blank",1,"btn","btn-success",3,"routerLink"],[1,"fa","fa-plus","me-2"],[1,"search-sort-container","d-flex","gap-2"],["placeholder","Search posts",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-select",3,"ngModelChange","ngModel"],["value","created_at"],["value","title"],["value","asc"],["value","desc"],[1,"col-12","px-md-3","px-2"],["data-masonry","{ 'percentPosition': true }",1,"row","g-md-3","g-2"],["class","col-lg-3 col-md-3 col-sm-4 col-6 masonry-box",4,"ngFor","ngForOf"],["class","col-12 text-center",4,"ngIf"],[4,"ngIf"],[1,"col-lg-3","col-md-3","col-sm-4","col-6","masonry-box"],[1,"shadow","img-container"],[1,"position-relative","border","p-1","opacity-0"],[1,"w-100","img-fluid","d-block",3,"load","src","alt"],["role","group",1,"btn-group","w-100"],["class","btn btn-secondary btn-sm rounded-0 m-1","target","_blank",3,"click",4,"ngIf"],["target","_blank",1,"btn","btn-secondary","btn-sm","rounded-0","m-1",3,"routerLink"],[1,"fa","fa-eye","me-2"],[1,"position-absolute","top-0","start-50","translate-middle","badge","rounded-pill","bg-danger","d-none","d-md-block"],["target","_blank",1,"btn","btn-secondary","btn-sm","rounded-0","m-1",3,"click"],[1,"fa","fa-edit","me-2"],[1,"col-12","text-center"],["pagination","",1,"mt-0","mb-0","px-3",3,"currentPageChange","pageSizeChange","currentPage","totalItems","pageSize","pageSizes"]],template:function(e,t){if(e&1){let r=I();o(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"button",5),b(5,"i",6),p(6,"Image "),s()(),o(7,"div",4)(8,"div",7)(9,"input",8),E("ngModelChange",function(a){return c(r),V(t.search,a)||(t.search=a),d(a)}),_("ngModelChange",function(){return c(r),d(t.changePage(1))}),s(),o(10,"select",9),E("ngModelChange",function(a){return c(r),V(t.sortBy,a)||(t.sortBy=a),d(a)}),_("ngModelChange",function(){return c(r),d(t.changePage(1))}),o(11,"option",10),p(12,"Date Created"),s(),o(13,"option",11),p(14,"Title"),s()(),o(15,"select",9),E("ngModelChange",function(a){return c(r),V(t.order,a)||(t.order=a),d(a)}),_("ngModelChange",function(){return c(r),d(t.changePage(1))}),o(16,"option",12),p(17,"Ascending"),s(),o(18,"option",13),p(19,"Descending"),s()()()(),k(20),o(21,"div",14)(22,"div",15,0),S(24,Le,12,7,"div",16),v(25,"async"),s()(),S(26,Pe,3,0,"div",17),v(27,"async"),v(28,"async"),$(),s(),S(29,be,2,5,"ng-container",18),v(30,"async"),s()()}e&2&&(l(4),h("routerLink","/images/post-generate"),l(5),x("ngModel",t.search),l(),x("ngModel",t.sortBy),l(5),x("ngModel",t.order),l(9),h("ngForOf",C(25,7,t.posts$)),l(2),h("ngIf",C(27,9,t.posts$)&&!C(28,11,t.posts$).length),l(3),h("ngIf",C(30,13,t.pagination$)))},dependencies:[J,K,ne,ue,de,pe,se,ce,le,me,X],changeDetection:0})}}return n})();var xe=[{path:"",component:ye,data:{title:"Image List",breadcrumb:"Image List",description:"Your Page Description"}}],ve=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=P({type:n})}static{this.\u0275inj=L({imports:[z.forChild(xe),z]})}}return n})();var it=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=P({type:n})}static{this.\u0275inj=L({imports:[Z,ve,he,ge]})}}return n})();export{it as ImageListModule};
