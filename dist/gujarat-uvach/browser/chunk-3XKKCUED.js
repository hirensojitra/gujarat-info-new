import{a as ne,d as re,h as oe}from"./chunk-555VBDUF.js";import{a as G}from"./chunk-VQZBWEMX.js";import"./chunk-QLZUZ3RB.js";import{a as B}from"./chunk-TA2AY7PX.js";import"./chunk-ZVTIIPRU.js";import{b as Z}from"./chunk-CESRFNRM.js";import{a as ee}from"./chunk-4V34LOIN.js";import{m as te,r as ie}from"./chunk-XCZXEFLX.js";import"./chunk-PT4ZZHU7.js";import{a as P}from"./chunk-32SRTGJU.js";import"./chunk-TRNUXQ43.js";import{e as Q,g as X}from"./chunk-OXB4PLKM.js";import"./chunk-UZTEO7AJ.js";import"./chunk-OK5S6IU3.js";import{B as q,C as K,c as J,g as H,l as Y}from"./chunk-Q2AVQJVA.js";import{w as E}from"./chunk-L7QDSQPY.js";import{$b as c,Db as x,Ea as d,Eb as D,Fa as m,Fb as g,Hb as N,Ma as T,Qb as o,Rb as a,Sb as p,Wb as v,Zb as f,fb as M,ic as R,jc as s,jd as U,kb as l,kc as I,kd as z,la as w,lb as b,lc as j,oc as F,od as W,pc as S,qc as y,rb as O,uc as L,ud as $,va as k,vc as A,wa as C}from"./chunk-WBTZQM6H.js";import{f as V}from"./chunk-CWTPBX7D.js";var de=r=>({"background-image":r,"background-size":"contain","background-position":"center","background-repeat":"no-repeat"}),me=()=>[12,24,48];function ce(r,_){if(r&1){let e=v();o(0,"button",29),f("click",function(){d(e),c();let t=R(10);return m(t.click())}),p(1,"i",30),s(2,"Upload "),a()}}function ge(r,_){if(r&1){let e=v();o(0,"div",31)(1,"input",32),y("ngModelChange",function(t){d(e);let n=c();return S(n.newFolderName,t)||(n.newFolderName=t),m(t)}),a(),o(2,"button",33),f("click",function(){d(e);let t=c();return m(t.createFolder())}),p(3,"i",34),a()()}if(r&2){let e=c();l(),F("ngModel",e.newFolderName),l(),g("disabled",!(e.newFolderName!=null&&e.newFolderName.trim()))}}function pe(r,_){if(r&1){let e=v();o(0,"li",35),f("click",function(){let t=d(e).$implicit,n=c();return m(n.selectFolder(t))}),o(1,"span"),s(2),a(),o(3,"button",36),f("click",function(){let t=d(e).$implicit,n=c();return m(n.deleteFolder(t))}),p(4,"i",37),a()()}if(r&2){let e=_.$implicit,i=c();N("active",e.id===(i.selectedFolder==null?null:i.selectedFolder.id)),l(2),I(e.name)}}function fe(r,_){if(r&1){let e=v();o(0,"div",38)(1,"div",39),p(2,"div",40),o(3,"div",41)(4,"div",42)(5,"small",43),s(6),a(),o(7,"div",44)(8,"button",45),p(9,"i",46),a(),o(10,"ul",47)(11,"li")(12,"button",48),f("click",function(t){let n=d(e).$implicit,u=c();return m(u.copyHrefToClipboard(t,n))}),p(13,"i",49),s(14,"Copy URL"),a()(),o(15,"li")(16,"button",48),f("click",function(){let t=d(e).$implicit,n=c();return m(n.refreshImage(t))}),p(17,"i",50),s(18,"Refresh"),a()(),o(19,"li")(20,"button",51),f("click",function(){let t=d(e).$implicit,n=c();return m(n.openConfirmModal(t))}),p(21,"i",52),s(22,"Delete"),a()(),o(23,"li")(24,"a",53),p(25,"i",54),s(26,"Open"),a()(),o(27,"li")(28,"a",55),p(29,"i",56),s(30,"Download"),a()()()()()()()()}if(r&2){let e=_.$implicit,i=c();l(2),g("ngStyle",A(5,de,"url("+i.apiUrl+"/user-img/uploads/"+e.id+"?thumb=medium)")),D("aria-label",e.metadata||"Image"),l(4),I(e.image_url||"Unnamed"),l(18),g("href",i.apiUrl+"/user-img/uploads/"+e.id,M),l(4),g("href",i.apiUrl+"/user-img/uploads/"+e.id,M)}}function ue(r,_){if(r&1){let e=v();o(0,"div",57)(1,"div",58),f("currentPageChange",function(t){d(e);let n=c();return m(n.onImagePageChange(t))})("pageSizeChange",function(t){d(e);let n=c();return m(n.onImagePageSizeChange(t))}),a()()}if(r&2){let e=c();l(),g("currentPage",e.imagePage)("totalItems",e.totalImages)("pageSize",e.imageLimit)("pageSizes",L(4,me))}}function he(r,_){r&1&&(o(0,"div",59),s(1," You do not have permission to view this content. "),a())}var le=(()=>{class r{constructor(e,i,t,n,u,h){this.imgService=e,this.authService=i,this.roleService=t,this.elementRef=n,this.renderer=u,this.toastService=h,this.folders=[],this.images=[],this.selectedFolder=null,this.role="",this.search="",this.sort="DESC",this.folderPage=1,this.folderLimit=9999,this.totalFolders=0,this.imagePage=1,this.imageLimit=12,this.totalImages=0,this.uploads=[],this.apiUrl=P.MasterApi,this.loading={folders:!1,images:!1,uploading:!1},this.newFolderName="",this.folderError="",this.modalTitle="",this.modalMessage="",this.pendingDeleteImage=null}ngOnInit(){return V(this,null,function*(){let e=yield this.authService.getUser();e&&this.roleService.getRoles().subscribe(i=>{let t=i.find(n=>n.id===e.role_id);this.role=t?.code??"VIEWER",this.loadInitialData()})})}createFolder(){this.newFolderName.trim()&&this.imgService.createFolder(this.newFolderName.trim()).subscribe({next:e=>{this.folderError="",this.newFolderName="",this.loadFolders()},error:e=>{console.error("Folder creation failed",e),this.folderError=e?.message||"Error creating folder."}})}deleteFolder(e){!e||!e.id||!confirm(`Are you sure you want to delete the folder "${e.name}"?`)||this.imgService.deleteFolder(e.id).subscribe({next:t=>{e.id===this.selectedFolder?.id&&(this.selectedFolder=null,this.loadFolders(),this.images=[])},error:t=>{console.error("Failed to delete folder:",t),alert("Error deleting folder.")}})}loadInitialData(){this.loading.folders=!0,this.imgService.getFolders({page:1,limit:this.folderLimit,search:this.search,sortBy:"created_at",order:this.sort}).subscribe({next:e=>{this.folders=e.folders,this.totalFolders=e.total;let i=this.folders.length>0?this.folders[0]:null;this.selectedFolder=i,i?this.imgService.getImagesInFolder(i.id,1,this.imageLimit,"","DESC").subscribe(t=>{this.images=t.images,this.totalImages=t.total,this.loading.folders=!1}):this.loading.folders=!1},error:()=>{this.loading.folders=!1}})}loadFolders(){this.imgService.getFolders({page:this.folderPage,limit:this.folderLimit,search:this.search,sortBy:"created_at",order:this.sort}).subscribe(e=>{this.folders=e.folders,this.totalFolders=e.total,this.folders.length>0&&(this.selectedFolder=this.folders[0],this.loadImages())})}selectFolder(e){!e||e.id===this.selectedFolder?.id||(this.selectedFolder=e,this.imagePage=1,this.loadImages())}loadImages(){this.selectedFolder&&(this.loading.images=!0,this.imgService.getImagesInFolder(this.selectedFolder.id,this.imagePage,this.imageLimit,"","DESC").subscribe({next:e=>{this.images=e.images,this.totalImages=e.total,this.loading.images=!1},error:()=>{this.loading.images=!1}}))}onFolderPageChange(e){this.folderPage!==e&&(this.folderPage=e,this.loadFolders())}onFolderPageSizeChange(e){this.folderLimit!==e&&(this.folderLimit=e,this.folderPage=1,this.loadFolders())}onImagePageChange(e){this.imagePage!==e&&(this.imagePage=e,this.loadImages())}onImagePageSizeChange(e){this.imageLimit!==e&&(this.imageLimit=e,this.imagePage=1,this.loadImages())}onFileSelected(e){let t=e.target.files;t&&this.uploadImages(Array.from(t))}onDragOver(e){e.preventDefault()}onDrop(e){e.preventDefault(),e.dataTransfer?.files&&this.uploadImages(Array.from(e.dataTransfer.files))}uploadImages(e){if(this.selectedFolder)for(let i of e){let t=i.name.split(".").pop()?.toLowerCase();if(!["jpg","jpeg","png"].includes(t||"")){alert("Only JPG, JPEG, or PNG files are allowed.");continue}let n={name:i.name,progress:0,status:"uploading"};this.uploads.push(n),this.imgService.uploadImage(this.selectedFolder.id,i,JSON.stringify({description:"Sample Image"})).subscribe({next:()=>{n.progress=100,n.status="completed",this.loadImages()},error:()=>{n.status="error"}})}}refreshImage(e){let i=document.createElement("input");i.type="file",i.accept="image/jpeg,image/png,image/jpg",i.onchange=t=>{let n=t.target;if(n.files&&n.files.length>0){let u=n.files[0];if(!this.selectedFolder)return;this.imgService.refreshImage(e.id,this.selectedFolder.id,u).subscribe({next:()=>this.loadImages(),error:h=>{console.error("Error refreshing image:",h),alert("Failed to refresh image")}})}},i.click()}deleteImage(e){!this.selectedFolder||!confirm(`Are you sure you want to delete "${e.id}"?`)||this.imgService.deleteImage(this.selectedFolder.id,e.id).subscribe({next:()=>this.loadImages(),error:()=>alert("Failed to delete the image.")})}getImageUrl(e){return`${e.image_url}`}canUpload(){return this.role==="OWNER"||this.role==="ADMINISTRATOR"}canDelete(){return this.role==="OWNER"||this.role==="ADMINISTRATOR"}canView(){return this.role!=="VIEWER"}openConfirmModal(e){this.modalTitle="Confirm Delete",this.modalMessage=`Are you sure you want to delete "${e.id}"?`,this.pendingDeleteImage=e,new bootstrap.Modal(document.getElementById("confirmModal")).show()}confirmModal(){!this.selectedFolder||!this.pendingDeleteImage||(this.imgService.deleteImage(this.selectedFolder.id,this.pendingDeleteImage.id).subscribe({next:()=>this.loadImages(),error:()=>alert("Failed to delete image.")}),this.pendingDeleteImage=null)}copyHrefToClipboard(e,i){e.preventDefault();let t=this.renderer.createElement("textarea");t.value=P.MasterApi+"/user-img/uploads/"+i.id,this.renderer.appendChild(this.elementRef.nativeElement,t),t.select(),document.execCommand("copy"),this.renderer.removeChild(this.elementRef.nativeElement,t),this.toastService.show("Image File path copied to clipboard",{title:"Copy Successed",class:"bg-success"})}static{this.\u0275fac=function(i){return new(i||r)(b(ne),b(B),b(G),b(T),b(O),b(ee))}}static{this.\u0275cmp=k({type:r,selectors:[["app-image-manager"]],decls:38,vars:10,consts:[["fileInput",""],[1,"h-100","d-flex","flex-column","container-fluid"],[1,"d-flex","flex-column","flex-md-row","align-items-start","align-items-md-center","justify-content-between","border-bottom","py-3","bg-white"],[1,"mb-1","fw-bold"],[1,"text-muted"],[1,"mt-2","mt-md-0"],["class","btn btn-primary",3,"click",4,"ngIf"],["type","file","hidden","","multiple","",3,"change"],[1,"row","flex-grow-1","m-0"],[1,"col-md-3","border-end","p-3","bg-light","overflow-auto"],["class","d-flex mb-2",4,"ngIf"],["type","text","placeholder","Search...",1,"form-control","mb-3",3,"ngModelChange","ngModel"],[1,"list-group"],["class","list-group-item list-group-item-action d-flex justify-content-between align-items-center",3,"active","click",4,"ngFor","ngForOf"],[1,"col-md-9","py-3","overflow-auto"],[1,"row","g-3"],["class","col-6 col-sm-4 col-md-3 col-lg-2",4,"ngFor","ngForOf"],["class","mt-4",4,"ngIf"],["class","alert alert-warning m-3",4,"ngIf"],["id","confirmModal","tabindex","-1","aria-labelledby","confirmModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-danger",3,"click"],[1,"btn","btn-primary",3,"click"],[1,"fa","fa-upload","me-2"],[1,"d-flex","mb-2"],["type","text","placeholder","New folder name",1,"form-control","me-1",3,"ngModelChange","ngModel"],[1,"btn","btn-success",3,"click","disabled"],[1,"fa","fa-plus"],[1,"list-group-item","list-group-item-action","d-flex","justify-content-between","align-items-center",3,"click"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"fa","fa-trash"],[1,"col-6","col-sm-4","col-md-3","col-lg-2"],[1,"card","border","shadow-sm"],["role","img",1,"ratio","ratio-1x1","bg-light","bg-opacity-25",3,"ngStyle"],[1,"card-body","p-2"],[1,"d-flex","justify-content-between","align-items-center"],[1,"text-truncate",2,"max-width","75%"],[1,"dropdown"],["type","button","data-bs-toggle","dropdown",1,"btn","btn-sm"],[1,"fa","fa-ellipsis-v"],[1,"dropdown-menu","dropdown-menu-end"],[1,"dropdown-item",3,"click"],[1,"fa","fa-copy","me-2"],[1,"fa","fa-refresh","me-2"],[1,"dropdown-item","text-danger",3,"click"],[1,"fa","fa-trash","me-2"],["target","_blank",1,"dropdown-item",3,"href"],[1,"fa","fa-eye","me-2"],["download","",1,"dropdown-item",3,"href"],[1,"fa","fa-download","me-2"],[1,"mt-4"],["pagination","",3,"currentPageChange","pageSizeChange","currentPage","totalItems","pageSize","pageSizes"],[1,"alert","alert-warning","m-3"]],template:function(i,t){if(i&1){let n=v();o(0,"div",1)(1,"div",2)(2,"div")(3,"h3",3),s(4,"Image Manager"),a(),o(5,"small",4),s(6),a()(),o(7,"div",5),x(8,ce,3,0,"button",6),o(9,"input",7,0),f("change",function(h){return d(n),m(t.onFileSelected(h))}),a()()(),o(11,"div",8)(12,"div",9)(13,"h5"),s(14,"Folders"),a(),x(15,ge,4,2,"div",10),o(16,"input",11),y("ngModelChange",function(h){return d(n),S(t.search,h)||(t.search=h),m(h)}),f("ngModelChange",function(){return d(n),m(t.loadFolders())}),a(),o(17,"ul",12),x(18,pe,5,3,"li",13),a()(),o(19,"div",14)(20,"div",15),x(21,fe,31,7,"div",16),a(),x(22,ue,2,5,"div",17),a()(),x(23,he,2,0,"div",18),o(24,"div",19)(25,"div",20)(26,"div",21)(27,"div",22)(28,"h5",23),s(29),a(),p(30,"button",24),a(),o(31,"div",25),s(32),a(),o(33,"div",26)(34,"button",27),s(35,"Cancel"),a(),o(36,"button",28),f("click",function(){return d(n),m(t.confirmModal())}),s(37,"Yes"),a()()()()()()}i&2&&(l(6),j(" ",t.selectedFolder?t.selectedFolder.name:"All folders"," "),l(2),g("ngIf",t.canUpload()),l(7),g("ngIf",t.canUpload()),l(),F("ngModel",t.search),l(2),g("ngForOf",t.folders),l(3),g("ngForOf",t.images),l(),g("ngIf",t.totalImages>0),l(),g("ngIf",!t.canView()),l(6),I(t.modalTitle),l(3),I(t.modalMessage))},dependencies:[U,z,W,J,H,Y,te],styles:[".upload-container[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:8px;width:400px;margin:auto;box-shadow:0 0 10px #0000001a}.dropzone[_ngcontent-%COMP%]{border:2px dashed #ccc;padding:1.5rem;text-align:center;border-radius:6px;margin:1rem 0;cursor:pointer}.file-list[_ngcontent-%COMP%]{margin-top:1rem}.file-item[_ngcontent-%COMP%]{background:#f8f9fa;padding:.75rem;border-radius:6px;margin-bottom:.5rem}.file-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:14px;margin-bottom:5px}.progress-bar[_ngcontent-%COMP%]{width:100%;height:6px;background:#e0e0e0;border-radius:3px;overflow:hidden}.progress-fill[_ngcontent-%COMP%]{height:100%;background:#007bff;transition:width .3s}.progress-fill.complete[_ngcontent-%COMP%]{background:#28a745}.folder-list[_ngcontent-%COMP%]{max-width:300px;margin-right:20px;float:left}.image-section[_ngcontent-%COMP%]{margin-left:320px}.image-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.image-box[_ngcontent-%COMP%]{margin:10px;width:120px;overflow:hidden}.image-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:cover}"]})}}return r})();var _e=[{path:"",component:le}],se=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=C({type:r})}static{this.\u0275inj=w({imports:[E.forChild(_e),E]})}}return r})();var We=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=C({type:r})}static{this.\u0275inj=w({imports:[$,se,q,K,ie,re,X,Q,oe,Z]})}}return r})();export{We as ImageManagerModule};
