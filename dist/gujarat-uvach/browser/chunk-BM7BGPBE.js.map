{"version":3,"sources":["node_modules/ngx-cookie-service/fesm2022/ngx-cookie-service.mjs","src/app/common/services/user.service.ts"],"sourcesContent":["import * as i0 from '@angular/core';\nimport { PLATFORM_ID, Injectable, Inject } from '@angular/core';\nimport { isPlatformBrowser, DOCUMENT } from '@angular/common';\n\n// This service is based on the `ng2-cookies` package which sadly is not a service and does\n// not use `DOCUMENT` injection and therefore doesn't work well with AoT production builds.\n// Package: https://github.com/BCJTI/ng2-cookies\nclass CookieService {\n  constructor(document,\n  // Get the `PLATFORM_ID` so we can check if we're in a browser.\n  platformId) {\n    this.document = document;\n    this.platformId = platformId;\n    this.documentIsAccessible = isPlatformBrowser(this.platformId);\n  }\n  /**\n   * Get cookie Regular Expression\n   *\n   * @param name Cookie name\n   * @returns property RegExp\n   *\n   * @author: Stepan Suvorov\n   * @since: 1.0.0\n   */\n  static getCookieRegExp(name) {\n    const escapedName = name.replace(/([\\[\\]{}()|=;+?,.*^$])/gi, '\\\\$1');\n    return new RegExp('(?:^' + escapedName + '|;\\\\s*' + escapedName + ')=(.*?)(?:;|$)', 'g');\n  }\n  /**\n   * Gets the unencoded version of an encoded component of a Uniform Resource Identifier (URI).\n   *\n   * @param encodedURIComponent A value representing an encoded URI component.\n   *\n   * @returns The unencoded version of an encoded component of a Uniform Resource Identifier (URI).\n   *\n   * @author: Stepan Suvorov\n   * @since: 1.0.0\n   */\n  static safeDecodeURIComponent(encodedURIComponent) {\n    try {\n      return decodeURIComponent(encodedURIComponent);\n    } catch {\n      // probably it is not uri encoded. return as is\n      return encodedURIComponent;\n    }\n  }\n  /**\n   * Return `true` if {@link Document} is accessible, otherwise return `false`\n   *\n   * @param name Cookie name\n   * @returns boolean - whether cookie with specified name exists\n   *\n   * @author: Stepan Suvorov\n   * @since: 1.0.0\n   */\n  check(name) {\n    if (!this.documentIsAccessible) {\n      return false;\n    }\n    name = encodeURIComponent(name);\n    const regExp = CookieService.getCookieRegExp(name);\n    return regExp.test(this.document.cookie);\n  }\n  /**\n   * Get cookies by name\n   *\n   * @param name Cookie name\n   * @returns property value\n   *\n   * @author: Stepan Suvorov\n   * @since: 1.0.0\n   */\n  get(name) {\n    if (this.documentIsAccessible && this.check(name)) {\n      name = encodeURIComponent(name);\n      const regExp = CookieService.getCookieRegExp(name);\n      const result = regExp.exec(this.document.cookie);\n      return result[1] ? CookieService.safeDecodeURIComponent(result[1]) : '';\n    } else {\n      return '';\n    }\n  }\n  /**\n   * Get all cookies in JSON format\n   *\n   * @returns all the cookies in json\n   *\n   * @author: Stepan Suvorov\n   * @since: 1.0.0\n   */\n  getAll() {\n    if (!this.documentIsAccessible) {\n      return {};\n    }\n    const cookies = {};\n    const document = this.document;\n    if (document.cookie && document.cookie !== '') {\n      document.cookie.split(';').forEach(currentCookie => {\n        const [cookieName, cookieValue] = currentCookie.split('=');\n        cookies[CookieService.safeDecodeURIComponent(cookieName.replace(/^ /, ''))] = CookieService.safeDecodeURIComponent(cookieValue);\n      });\n    }\n    return cookies;\n  }\n  set(name, value, expiresOrOptions, path, domain, secure, sameSite, partitioned) {\n    if (!this.documentIsAccessible) {\n      return;\n    }\n    if (typeof expiresOrOptions === 'number' || expiresOrOptions instanceof Date || path || domain || secure || sameSite) {\n      const optionsBody = {\n        expires: expiresOrOptions,\n        path,\n        domain,\n        secure,\n        sameSite: sameSite ? sameSite : 'Lax',\n        partitioned\n      };\n      this.set(name, value, optionsBody);\n      return;\n    }\n    let cookieString = encodeURIComponent(name) + '=' + encodeURIComponent(value) + ';';\n    const options = expiresOrOptions ? expiresOrOptions : {};\n    if (options.expires) {\n      if (typeof options.expires === 'number') {\n        const dateExpires = new Date(new Date().getTime() + options.expires * 1000 * 60 * 60 * 24);\n        cookieString += 'expires=' + dateExpires.toUTCString() + ';';\n      } else {\n        cookieString += 'expires=' + options.expires.toUTCString() + ';';\n      }\n    }\n    if (options.path) {\n      cookieString += 'path=' + options.path + ';';\n    }\n    if (options.domain) {\n      cookieString += 'domain=' + options.domain + ';';\n    }\n    if (options.secure === false && options.sameSite === 'None') {\n      options.secure = true;\n      console.warn(`[ngx-cookie-service] Cookie ${name} was forced with secure flag because sameSite=None.` + `More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`);\n    }\n    if (options.secure) {\n      cookieString += 'secure;';\n    }\n    if (!options.sameSite) {\n      options.sameSite = 'Lax';\n    }\n    cookieString += 'sameSite=' + options.sameSite + ';';\n    if (options.partitioned) {\n      cookieString += 'Partitioned;';\n    }\n    this.document.cookie = cookieString;\n  }\n  /**\n   * Delete cookie by name\n   *\n   * @param name   Cookie name\n   * @param path   Cookie path\n   * @param domain Cookie domain\n   * @param secure Cookie secure flag\n   * @param sameSite Cookie sameSite flag - https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite\n   *\n   * @author: Stepan Suvorov\n   * @since: 1.0.0\n   */\n  delete(name, path, domain, secure, sameSite = 'Lax') {\n    if (!this.documentIsAccessible) {\n      return;\n    }\n    const expiresDate = new Date('Thu, 01 Jan 1970 00:00:01 GMT');\n    this.set(name, '', {\n      expires: expiresDate,\n      path,\n      domain,\n      secure,\n      sameSite\n    });\n  }\n  /**\n   * Delete all cookies\n   *\n   * @param path   Cookie path\n   * @param domain Cookie domain\n   * @param secure Is the Cookie secure\n   * @param sameSite Is the cookie same site\n   *\n   * @author: Stepan Suvorov\n   * @since: 1.0.0\n   */\n  deleteAll(path, domain, secure, sameSite = 'Lax') {\n    if (!this.documentIsAccessible) {\n      return;\n    }\n    const cookies = this.getAll();\n    for (const cookieName in cookies) {\n      if (cookies.hasOwnProperty(cookieName)) {\n        this.delete(cookieName, path, domain, secure, sameSite);\n      }\n    }\n  }\n  static {\n    this.ɵfac = function CookieService_Factory(t) {\n      return new (t || CookieService)(i0.ɵɵinject(DOCUMENT), i0.ɵɵinject(PLATFORM_ID));\n    };\n  }\n  static {\n    this.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n      token: CookieService,\n      factory: CookieService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(CookieService, [{\n    type: Injectable,\n    args: [{\n      providedIn: 'root'\n    }]\n  }], () => [{\n    type: Document,\n    decorators: [{\n      type: Inject,\n      args: [DOCUMENT]\n    }]\n  }, {\n    type: undefined,\n    decorators: [{\n      type: Inject,\n      args: [PLATFORM_ID]\n    }]\n  }], null);\n})();\n\n/*\n * Public API Surface of ngx-cookie-service\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { CookieService };\n","import { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\nimport { User } from '../interfaces/commonInterfaces';\r\nimport { environment } from '../../../environments/environment';\r\nimport { CookieService } from 'ngx-cookie-service';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class UserService {\r\n  private userSubject: BehaviorSubject<User | null> = new BehaviorSubject<User | null>(null);\r\n  private apiUrl = environment.MasterApi + '/auth';\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private cookieService: CookieService\r\n  ) {\r\n    // Initialize the user subject based on stored user details in cookies\r\n    const storedUser = this.cookieService.get('user');\r\n    if (storedUser) {\r\n      try {\r\n        const parsedUser = JSON.parse(storedUser);\r\n        this.userSubject.next(parsedUser);\r\n      } catch (error) {\r\n        console.error('Error parsing stored user:', error);\r\n        this.cookieService.delete('user');\r\n      }\r\n    }\r\n  }\r\n\r\n  getUser(): Observable<User | null> {\r\n    return this.userSubject.asObservable();\r\n  }\r\n\r\n  getFullName(): string {\r\n    const user = this.userSubject.value;\r\n    if (user) {\r\n      const firstName = user.firstname || ''; // Default to an empty string if undefined\r\n      const lastName = user.lastname || '';   // Default to an empty string if undefined\r\n      return `${firstName} ${lastName}`.trim(); // Ensure no extra spaces\r\n    }\r\n    return '';\r\n  }\r\n\r\n  // Set and store the user details in cookies\r\n  setUser(user: User): void {\r\n    this.cookieService.set('user', JSON.stringify(user), {\r\n      path: '/', // Ensures the cookie is available throughout the application\r\n      secure: false // Set to true if you're using HTTPS\r\n    });\r\n    this.userSubject.next(user);\r\n  }\r\n\r\n  // Update user data based on user ID\r\n  updateUserData(userid: string, updatedData: Partial<User>): Observable<any> {\r\n    const token = this.cookieService.get('token');\r\n    const headers = new HttpHeaders({\r\n      'Authorization': `Bearer ${token}`\r\n    });\r\n\r\n    // API endpoint for updating user data\r\n    const fullUrl = `${this.apiUrl}/updateUser/${userid}`;\r\n\r\n    return this.http.put(fullUrl, updatedData, { headers });\r\n  }\r\n\r\n  // Verify email by sending the verification link\r\n  verifyEmail(token: string, email: string): Observable<any> {\r\n    const headers = new HttpHeaders({\r\n      'Authorization': `Bearer ${this.cookieService.get('token')}`\r\n    });\r\n    return this.http.get(`${this.apiUrl}/verify-email?token=${encodeURIComponent(token)}&email=${encodeURIComponent(email)}`, { headers });\r\n  }\r\n\r\n  // Register a new user\r\n  registerUser(username: string, password: string, email: string, roles: string[], emailVerified: boolean): Observable<any> {\r\n    return this.http.post<any>(`${this.apiUrl}/register`, {\r\n      username,\r\n      password,\r\n      email,\r\n      roles,\r\n      emailVerified,\r\n    });\r\n  }\r\n}\r\n"],"mappings":"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","names":[],"x_google_ignoreList":[0]}