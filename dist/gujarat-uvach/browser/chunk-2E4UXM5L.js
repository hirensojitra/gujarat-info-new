import{e as z,g as E}from"./chunk-EU3RJ4QC.js";import{a as y}from"./chunk-YEISPT4C.js";import"./chunk-DMITPIK3.js";import{c as J,d as I,f as K,g as X,k as Z,o as ee,r as te,s as ie,t as ne,u as re,x as ae,y as oe,z as le}from"./chunk-23EI4VKN.js";import{Aa as P,Ba as F,Ca as O,Da as C,Ea as s,J as R,K as g,La as o,M as N,Ma as p,Na as _,P as L,Q as x,Qb as U,V as h,W as S,Ya as T,Za as M,ga as r,ha as b,hb as G,ib as $,jb as B,kb as q,lb as W,mb as Q,ob as H,pa as f,qa as j,ra as l,rb as Y,sa as k,t as w,xa as n,ya as i,za as u}from"./chunk-4GDYXFLP.js";import"./chunk-CWTPBX7D.js";var D=function(t){return t.MALE="MALE",t.FEMALE="FEMALE",t.NONBINARY="NONBINARY",t.OTHER="OTHER",t}(D||{}),A=function(t){return t.SINGLE="SINGLE",t.MARRIED="MARRIED",t.DIVORCED="DIVORCED",t.WIDOWED="WIDOWED",t}(A||{});var me=E`
  mutation UpdateUserProfile($input: UpdateUserInput!) {
    updateUserProfile(input: $input) {
      id
      firstname
      middlename
      lastname
      number
      number_verified
      role_id
      email
      email_verified
      username
      birthday
      gender
      marital_status
      language {
        id
        name
      }
    }
  }
`;var de=E`
  query GetLanguages {
    languages {
      id
      name
    }
  }
`;var se=(()=>{class t{constructor(e,a){this.apollo=e,this.authenticationService=a}refetchCurrentUser(){this.userQuery?.refetch()}updateProfile(e){let a=this.authenticationService.getToken();return console.log("input",e),this.apollo.mutate({mutation:me,variables:{input:e},context:{headers:{Authorization:`Bearer ${a}`}}}).pipe(w(m=>{let c=m.data.updateUserProfile;return this.userQuery?.refetch(),c}))}getLanguages(){return this.apollo.watchQuery({query:de}).valueChanges.pipe(w(({data:e})=>e.languages))}static{this.\u0275fac=function(a){return new(a||t)(N(z),N(y))}}static{this.\u0275prov=R({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function _e(t,d){if(t&1&&(n(0,"div",13)(1,"div",14),u(2,"i",29),i(),n(3,"div")(4,"div",16),o(5,"Name"),i(),n(6,"div",30)(7,"div",31),o(8),i(),n(9,"div",31),o(10),i(),n(11,"div",31),o(12),i()()()()),t&2){let e=s(3);r(8),p(e.user.firstname),r(2),p(e.user.middlename),r(2),p(e.user.lastname)}}function ge(t,d){if(t&1&&(n(0,"div",13)(1,"div",22),u(2,"i",23),i(),n(3,"div")(4,"div",16),o(5,"Number Verified"),i(),n(6,"div",17),o(7),i()()()),t&2){let e=s(3);r(),l("ngClass",e.user.number_verified?"text-success":"text-danger"),r(),l("ngClass",e.user.number_verified?"fa-check":"fa-close"),r(5),p(e.user.number_verified)}}function xe(t,d){if(t&1&&(n(0,"div",13)(1,"div",27),u(2,"i",32),i(),n(3,"div")(4,"div",16),o(5,"Birthday"),i(),n(6,"div",17),o(7),i()()()),t&2){let e=s(3);r(7),p(e.user.birthday)}}function he(t,d){if(t&1&&(n(0,"div",13)(1,"div",27),u(2,"i",33),i(),n(3,"div")(4,"div",16),o(5,"Gender"),i(),n(6,"div",17),o(7),i()()()),t&2){let e=s(3);r(7),p(e.user.gender)}}function Se(t,d){if(t&1&&(n(0,"div",13)(1,"div",27),u(2,"i",34),i(),n(3,"div")(4,"div",16),o(5,"Marital Status"),i(),n(6,"div",17),o(7),i()()()),t&2){let e=s(3);r(7),p(e.user.marital_status)}}function be(t,d){if(t&1&&(n(0,"div",9)(1,"div",10)(2,"div",11),f(3,_e,13,3,"div",12),n(4,"div",13)(5,"div",14),u(6,"i",15),i(),n(7,"div")(8,"div",16),o(9,"ID"),i(),n(10,"div",17),o(11),i()()(),n(12,"div",13)(13,"div",18),u(14,"i",19),i(),n(15,"div")(16,"div",16),o(17,"Mobile Number"),i(),n(18,"div",17),o(19),i()()(),f(20,ge,8,3,"div",12),n(21,"div",13)(22,"div",20),u(23,"i",21),i(),n(24,"div")(25,"div",16),o(26,"Email"),i(),n(27,"div",17),o(28),i()()(),n(29,"div",13)(30,"div",22),u(31,"i",23),i(),n(32,"div")(33,"div",16),o(34,"Email Verified"),i(),n(35,"div",17),o(36),i()()(),n(37,"div",13)(38,"div",24),u(39,"i",25),i(),n(40,"div")(41,"div",16),o(42,"Role ID"),i(),n(43,"div",17),o(44),i()()(),n(45,"div",13)(46,"div",14),u(47,"i",26),i(),n(48,"div")(49,"div",16),o(50,"Username"),i(),n(51,"div",17),o(52),i()()(),f(53,xe,8,1,"div",12)(54,he,8,1,"div",12)(55,Se,8,1,"div",12),n(56,"div",13)(57,"div",27),u(58,"i",28),i(),n(59,"div")(60,"div",16),o(61,"Language"),i(),n(62,"div",17),o(63),i()()()()()()),t&2){let e=s(2);r(3),l("ngIf",e.user.firstname||e.user.lastname||e.user.middlename),r(8),p(e.user.id),r(8),p(e.user.number||"Not Updated"),r(),l("ngIf",e.user.number),r(8),p(e.user.email),r(2),l("ngClass",e.user.email?"text-success":"text-danger"),r(),l("ngClass",e.user.email_verified?"fa-check":"fa-close"),r(5),p(e.user.email_verified),r(8),p(e.user.role_id),r(8),p(e.user.username||"Not Uvailable"),r(),l("ngIf",e.user.birthday),r(),l("ngIf",e.user.gender),r(),l("ngIf",e.user.marital_status),r(8),p(e.user.language.name)}}function Ce(t,d){if(t&1&&(n(0,"option",49),o(1),T(2,"titlecase"),i()),t&2){let e=d.$implicit;l("value",e),r(),_(" ",M(2,2,e)," ")}}function Ee(t,d){if(t&1&&(n(0,"select",46)(1,"option",47),o(2,"-- Select Gender --"),i(),f(3,Ce,3,4,"option",48),i()),t&2){let e=s().$implicit,a=s(3);l("id",e.name)("formControlName",e.name),r(),l("ngValue",null),r(2),l("ngForOf",a.genderOptions)}}function ye(t,d){if(t&1&&(n(0,"option",49),o(1),T(2,"titlecase"),i()),t&2){let e=d.$implicit;l("value",e),r(),_(" ",M(2,2,e)," ")}}function Ie(t,d){if(t&1&&(n(0,"select",46)(1,"option",47),o(2,"-- Select Marital Status --"),i(),f(3,ye,3,4,"option",48),i()),t&2){let e=s().$implicit,a=s(3);l("id",e.name)("formControlName",e.name),r(),l("ngValue",null),r(2),l("ngForOf",a.maritalStatusOptions)}}function we(t,d){if(t&1&&(n(0,"option",49),o(1),i()),t&2){let e=d.$implicit;l("value",e.id),r(),_(" ",e.name," ")}}function Ne(t,d){if(t&1&&(n(0,"select",50)(1,"option",47),o(2,"-- Select Language --"),i(),f(3,we,2,2,"option",48),i()),t&2){let e=s().$implicit,a=s(3);l("formControlName",e.name),r(),l("ngValue",null),r(2),l("ngForOf",a.languageOptions)}}function Pe(t,d){if(t&1&&u(0,"input",51),t&2){let e=s().$implicit;l("type",e.type)("id",e.name)("formControlName",e.name)}}function Fe(t,d){if(t&1&&(P(0),n(1,"div",40)(2,"label",41),o(3),i(),P(4,42),f(5,Ee,4,4,"select",43)(6,Ie,4,4,"select",43)(7,Ne,4,3,"select",44)(8,Pe,1,3,"input",45),F(),i(),F()),t&2){let e=d.$implicit;r(2),l("for",e.name),r(),p(e.label),r(),l("ngSwitch",e.name),r(),l("ngSwitchCase","gender"),r(),l("ngSwitchCase","marital_status"),r(),l("ngSwitchCase","language_id")}}function Oe(t,d){if(t&1){let e=O();n(0,"div")(1,"form",35),C("ngSubmit",function(){h(e);let m=s(2);return S(m.onSubmit())}),n(2,"div",36),f(3,Fe,9,6,"ng-container",37),i(),n(4,"button",38),o(5," Save "),i(),n(6,"button",39),C("click",function(){h(e);let m=s(2);return S(m.toggleEdit())}),o(7," Cancel "),i()()()}if(t&2){let e=s(2);r(),l("formGroup",e.profileForm),r(2),l("ngForOf",e.formFields),r(),l("disabled",e.profileForm.invalid)}}function Te(t,d){if(t&1){let e=O();n(0,"div",1),f(1,be,64,14,"div",2)(2,Oe,8,3,"div",3),n(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7),o(7),i()()(),n(8,"button",8),C("click",function(){h(e);let m=s();return S(m.toggleEdit())}),o(9),i()()()}if(t&2){let e=s();r(),l("ngIf",!e.editing),r(),l("ngIf",e.editing),r(4),k("width",e.completion,"%"),j("aria-valuenow",e.completion),r(),_(" ",e.completion,"% "),r(2),_(" ",e.editing?"Cancel":e.completion<100?"Complete Profile":"Edit Profile"," ")}}var ce=(()=>{class t{constructor(e,a,m){this.authService=e,this.updateUserService=a,this.fb=m,this.user=null,this.editing=!1,this.completion=0,this.genderOptions=Object.values(D),this.maritalStatusOptions=Object.values(A),this.languageOptions=[],this.formFields=[{name:"firstname",label:"First Name",type:"text",validators:[I.required]},{name:"middlename",label:"Middle Name",type:"text",validators:[]},{name:"lastname",label:"Last Name",type:"text",validators:[I.required]},{name:"number",label:"Mobile Number",type:"tel",validators:[I.required]},{name:"birthday",label:"Birthday",type:"date",validators:[]},{name:"gender",label:"Gender",type:"select",validators:[]},{name:"marital_status",label:"Marital Status",type:"select",validators:[]},{name:"language_id",label:"Language",type:"select",validators:[]}]}ngOnInit(){this.sub=this.authService.user$.subscribe(e=>{this.user=e,this.calculateCompletion(),this.editing&&this.buildForm()}),this.updateUserService.getLanguages().subscribe(e=>{this.languageOptions=e})}ngOnDestroy(){this.sub?.unsubscribe()}toggleEdit(){this.editing=!this.editing,this.editing&&this.buildForm()}buildForm(){let e={};this.formFields.forEach(a=>{let m="";this.user&&(a.name==="language_id"?m=this.user.language.id:m=this.user[a.name]??""),e[a.name]=[m,a.validators]}),this.profileForm=this.fb.group(e)}calculateCompletion(){if(!this.user){this.completion=0;return}let e=this.formFields.map(c=>c.name),a=e.length,m=e.reduce((c,v)=>v==="language_id"?this.user.language.id?c+1:c:this.user[v]?c+1:c,0);this.completion=Math.round(m/a*100)}onSubmit(){if(this.profileForm.invalid||!this.user)return;let e=this.profileForm.value,a={},m=!1;for(let[c,v]of Object.entries(e))if(!(v===""||v==null))if(c==="language_id")v!==this.user.language.id&&(a[c]=v);else{let ue=this.user[c];String(v)!==String(ue)&&(a[c]=v,c==="number"&&(m=!0))}if(m&&(a.number=e.number),!Object.keys(a).length){this.editing=!1;return}this.updateUserService.updateProfile(a).subscribe(c=>{this.authService.setUser(c),this.editing=!1})}static{this.\u0275fac=function(a){return new(a||t)(b(y),b(se),b(ae))}}static{this.\u0275cmp=L({type:t,selectors:[["app-profile"]],decls:1,vars:1,consts:[["class","container my-5",4,"ngIf"],[1,"container","my-5"],["class","card mx-auto shadow-lg","style","max-width:900px; border-radius:1rem; overflow:hidden;",4,"ngIf"],[4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","my-4"],[1,"flex-grow-1","me-3"],[1,"progress"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar"],[1,"btn","btn-primary",3,"click"],[1,"card","mx-auto","shadow-lg",2,"max-width","900px","border-radius","1rem","overflow","hidden"],[1,"card-body","px-4","pt-4"],[1,"row","gx-2"],["class","col-md-6 d-flex align-items-center pb-2 mb-2 border-bottom",4,"ngIf"],[1,"col-md-6","d-flex","align-items-center","pb-2","mb-2","border-bottom"],[1,"icon-circle","bg-white","text-primary","me-3"],[1,"fa","fa-id-card"],[1,"fw-bold"],[1,"text-muted","small"],[1,"icon-circle","bg-white","text-success","me-3"],[1,"fa","fa-phone"],[1,"icon-circle","bg-white","text-warning","me-3"],[1,"fa","fa-envelope"],[1,"icon-circle","bg-white","me-3",3,"ngClass"],[1,"fa",3,"ngClass"],[1,"icon-circle","bg-white","text-info","me-3"],[1,"fa","fa-tag"],[1,"fa","fa-user-circle"],[1,"icon-circle","bg-white","text-secondary","me-3"],[1,"fa","fa-language"],[1,"fa","fa-user"],[1,"d-flex"],[1,"text-muted","small","me-2"],[1,"fa","fa-calendar"],[1,"fa","fa-venus-mars"],[1,"fa","fa-users"],[1,"mx-auto",2,"max-width","900px",3,"ngSubmit","formGroup"],[1,"row"],[4,"ngFor","ngForOf"],["type","submit",1,"btn","btn-success","me-2",3,"disabled"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"col-md-6","mb-3"],[1,"form-label",3,"for"],[3,"ngSwitch"],["class","form-select",3,"id","formControlName",4,"ngSwitchCase"],["class","form-select",3,"formControlName",4,"ngSwitchCase"],["class","form-control",3,"type","id","formControlName",4,"ngSwitchDefault"],[1,"form-select",3,"id","formControlName"],[3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"form-select",3,"formControlName"],[1,"form-control",3,"type","id","formControlName"]],template:function(a,m){a&1&&f(0,Te,10,7,"div",0),a&2&&l("ngIf",m.user)},dependencies:[G,$,B,q,W,Q,Z,ne,re,J,ie,K,X,ee,te,H]})}}return t})();var Me=[{path:"",component:ce,data:{title:"",description:"",keywords:"",robots:""}}],pe=(()=>{class t{static{this.\u0275fac=function(a){return new(a||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=g({imports:[U.forChild(Me),U]})}}return t})();var tt=(()=>{class t{static{this.\u0275fac=function(a){return new(a||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=g({imports:[Y,pe,oe,le]})}}return t})();export{tt as ProfileModule};
