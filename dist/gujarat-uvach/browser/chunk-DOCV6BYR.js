import{a as ue}from"./chunk-ZDCKU4GH.js";import{a as Q}from"./chunk-DSUL7FTM.js";import"./chunk-ZVTIIPRU.js";import{a as ee}from"./chunk-ZOEZP54S.js";import{a as $,g as te,i as ie,j as re,k as ne,r as ae}from"./chunk-XCZXEFLX.js";import"./chunk-PT4ZZHU7.js";import{a as z}from"./chunk-32SRTGJU.js";import{A as K,B as Y,C as Z,c as G,e as W,g as q,h as O,m as H,q as X,t as J}from"./chunk-Q2AVQJVA.js";import{t as L,w as V}from"./chunk-L7QDSQPY.js";import{$b as b,Db as C,Ea as f,Fa as h,Fb as m,Qb as o,Rb as n,Sb as d,Tb as T,Ub as A,Wb as w,Zb as _,cc as N,fb as D,fc as P,gc as E,hc as k,id as R,jc as s,kb as a,kc as x,kd as j,la as S,lb as v,lc as u,ud as B,va as M,vc as U,wa as y,wc as F}from"./chunk-WBTZQM6H.js";import{e as pe}from"./chunk-CWTPBX7D.js";var me=pe(ue());var ge=["imageInput"],fe=["imageInputBtn"],he=i=>({"img-thumbnail rounded-circle":i}),oe=i=>({"me-2":i}),le=(i,g)=>({"fa-pencil":i,"fa-plus":g});function ve(i,g){if(i&1){let e=w();o(0,"button",40),_("click",function(){f(e);let t=b();return h(t.deleteImage())}),d(1,"i",41),n()}}function _e(i,g){if(i&1&&(o(0,"p",19),s(1),n()),i&2){let e=b(2);a(),u("District: ",e.village.district_name&&e.village.district_gu_name?e.village.district_name+" - "+e.village.district_gu_name:e.village.district_name||e.village.district_gu_name||"Unavailable","")}}function be(i,g){if(i&1&&(o(0,"p",19),s(1),n()),i&2){let e=b(2);a(),u("Taluka: ",e.village.taluka_name&&e.village.taluka_gu_name?e.village.taluka_name+" - "+e.village.taluka_gu_name:e.village.taluka_name||e.village.taluka_gu_name||"Unavailable","")}}function Ce(i,g){if(i&1&&(o(0,"p",19),s(1),n()),i&2){let e=b(2);a(),u("Village: ",e.village.name&&e.village.gu_name?e.village.name+" - "+e.village.gu_name:e.village.name||e.village.gu_name||"Unavailable","")}}function Ie(i,g){if(i&1&&(T(0),C(1,_e,2,1,"p",42)(2,be,2,1,"p",42)(3,Ce,2,1,"p",42),A()),i&2){let e=b();a(),m("ngIf",e.village.district_name||e.village.district_gu_name),a(),m("ngIf",e.village.taluka_name||e.village.taluka_gu_name),a(),m("ngIf",e.village.name||e.village.gu_name)}}function Se(i,g){if(i&1){let e=w();o(0,"button",40),_("click",function(){f(e);let t=b();return h(t.deleteImage())}),d(1,"i",41),n()}}var de=(()=>{class i{constructor(e,r,t,l,c,p){this.fb=e,this.US=r,this.DS=t,this.villageService=l,this.talukaService=c,this.districtService=p,this.apiUrl=z.MasterApi+"/auth/profile-image/",this.village={},this.profilePictureForm=this.fb.group({username:["",W.required],image:[""]})}ngOnInit(){this.cropperModal=new bootstrap.Modal(document.getElementById("cropperModal"),{focus:!1,keyboard:!1,static:!1}),this.cropperModal._element.addEventListener("hide.bs.modal",()=>{this.cropper&&this.cropper.destroy()}),this.cropperModal._element.addEventListener("show.bs.modal",()=>{this.profilePictureForm.get("username")?.setValue(this.user.username)}),this.imageSelect=new bootstrap.Modal(document.getElementById("imageSelect"),{focus:!1,keyboard:!1,static:!1}),this.imageSelect._element.addEventListener("hidden.bs.modal",()=>{let e=this.imageInput.nativeElement;e.files&&e.files.length>0||this.imageSelect.show()}),this.imageSelect._element.addEventListener("show.bs.modal",()=>{this.profilePictureForm.get("username")?.setValue(this.user.username)}),this.userSubscription=this.US.getUser().subscribe(e=>{e&&(this.user=e,this.profilePictureForm.get("username")?.setValue(e.username),e.village_id?this.getVillage(e.village_id):e.taluka_id?this.getTaluka(e.taluka_id):this.getDistrict(e.district_id),this.validateImage(this.user.username))})}ngAfterViewInit(){}openImageCropperDialog(){let e=this.imageInput.nativeElement;e&&(e.click(),e.value=null)}handleImageInputChange(e){let t=e.target.files?.[0];if(t&&(t.type==="image/jpeg"||t.type==="image/png")){this.imageSelect.hide();let l=new FileReader;l.onload=c=>{let p=c.target?.result;this.cropperModal.show();let I=document.getElementById("cropper");this.cropper=new me.default(I,{aspectRatio:1,scalable:!0,viewMode:1,crop:we=>{},autoCropArea:1,dragMode:"move",responsive:!0,cropBoxResizable:!1,minCropBoxWidth:320,minCropBoxHeight:320,minContainerWidth:320,minContainerHeight:320}),this.cropper.replace(p)},l.readAsDataURL(t)}else this.imageSelect.show()}handleCropEvent(){if(this.cropper){let e=this.cropper.getCroppedCanvas(),r=document.createElement("canvas"),t=r.getContext("2d");r.width=320,r.height=320,t.drawImage(e,0,0,320,320);let l=r.toDataURL("image/png");this.profilePictureForm.get("image")?.setValue(l)}}saveCroppedImage(){if(this.handleCropEvent(),this.profilePictureForm.valid){let e=new FormData,r=this.profilePictureForm.value;if(r.image){let t=this.base64ToFile(r.image,"profile-picture.png");e.append("image",t)}e.append("username",this.profilePictureForm.get("username")?.value),this.US.updateUser(this.user.id,e).subscribe(t=>{this.US.setUser(t.user),this.cropperModal.hide()},t=>{console.error("Error uploading image:",t)})}}base64ToFile(e,r){let t=e.split(","),l=t[0].match(/:(.*?);/)[1],c=atob(t[1]),p=c.length,I=new Uint8Array(p);for(;p--;)I[p]=c.charCodeAt(p);return new File([I],r,{type:l})}validateImage(e){let r=`?v=${new Date().getTime()}`,t=e?`${this.apiUrl+e}${r}`:`https://dummyimage.com/300x300/F4F4F4/000000&text=${this.imageText()}`;this.imageUrl=t}imageText(){if(this.user&&this.user.firstname&&this.user.lastname){let e=this.user.firstname.charAt(0),r=this.user.lastname.charAt(0);return` ${e}${r} `}else return"USER"}deleteImage(){if(this.profilePictureForm.get("username")?.setValue(this.user.username),this.profilePictureForm.get("image")?.setValue("delete"),this.user){let e=this.profilePictureForm.value;if(!Object.keys(e).some(l=>this.user[l]!==e[l])){console.log("User data has not changed. Skipping update.");return}let t=this.user?.username||"";this.user.image=null,this.US.setUser(this.user)}}getVillage(e){this.villageService.getVillageById(e).subscribe(r=>{let t=r;t&&(this.village=t)},r=>{})}getTaluka(e){this.talukaService.getTalukaById(e).subscribe(r=>{let t=r.data[0];t&&(this.village={district_gu_name:t.district_gu_name,district_name:t.district_name,taluka_gu_name:t.gu_name,taluka_name:t.name})},r=>{})}getDistrict(e){this.districtService.getDistrictById(e).subscribe(r=>{let t=r;t&&(this.village={district_gu_name:t.gu_name,district_name:t.name})},r=>{})}static{this.\u0275fac=function(r){return new(r||i)(v(K),v(Q),v(ee),v(ne),v(re),v(ie))}}static{this.\u0275cmp=M({type:i,selectors:[["app-user-profile"]],viewQuery:function(r,t){if(r&1&&(P(ge,5),P(fe,5)),r&2){let l;E(l=k())&&(t.imageInput=l.first),E(l=k())&&(t.imageInputBtn=l.first)}},decls:67,vars:31,consts:[["imageInput",""],[1,"h-100","d-flex","flex-column"],[1,"p-3","d-flex","flex-column","flex-grow-1"],[1,"row","flex-grow-1","g-3"],[1,"col-sm-4"],[1,"card","h-100","w-100","rounded-0","p-3"],[1,"row","g-3","align-items-center"],[1,"col-md-12"],["remSize","",1,"mx-auto",3,"maxWPX"],[1,"w-100",3,"src","ngClass","alt"],[1,"d-flex","align-items-center","justify-content-center"],[1,"btn","btn-primary","btn-sm",3,"click","ngClass"],[1,"fa","me-2",3,"ngClass"],["class","btn btn-danger btn-sm",3,"click",4,"ngIf"],[1,"card-body"],[1,"row"],[1,"col-md-6","offset-md-3"],[1,"card-title"],[1,"d-block","fw-normal"],[1,"card-text"],[4,"ngIf"],["type","file",2,"display","none",3,"change"],[1,"col-sm-8"],[1,"card","h-100","w-100","rounded-0","position-relative"],["id","cropperModal","tabindex","-1","aria-labelledby","cropperModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],["id","cropperModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["id","cropper","alt","Crop",1,"w-100"],[3,"formGroup"],["type","hidden","formControlName","username"],["type","hidden","formControlName","image"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary",3,"click"],["id","imageSelect","tabindex","-1","aria-labelledby","imageSelectLabel","aria-hidden","true",1,"modal","fade"],["id","imageSelectLabel",1,"modal-title"],[1,"btn","btn-danger","btn-sm",3,"click"],[1,"fa","fa-trash"],["class","card-text",4,"ngIf"]],template:function(r,t){if(r&1){let l=w();o(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"div",8),d(8,"img",9),n()(),o(9,"div",7)(10,"div",10)(11,"button",11),_("click",function(){return f(l),h(t.openImageCropperDialog())}),d(12,"i",12),s(13),n(),C(14,ve,2,0,"button",13),n()()(),o(15,"div",14)(16,"div",15)(17,"div",16)(18,"h5",17),s(19),o(20,"small",18),s(21),n()(),o(22,"p",19),s(23),n(),o(24,"p",19),s(25),n(),o(26,"p",19),s(27),n(),C(28,Ie,4,3,"ng-container",20),o(29,"input",21,0),_("change",function(p){return f(l),h(t.handleImageInputChange(p))}),n()()()()()(),o(31,"div",22)(32,"div",23),d(33,"router-outlet"),n()()()()(),o(34,"div",24)(35,"div",25)(36,"div",26)(37,"div",27)(38,"h5",28),s(39,"Profile Photo"),n(),d(40,"button",29),n(),o(41,"div",30),d(42,"img",31),o(43,"form",32),d(44,"input",33)(45,"input",34),n()(),o(46,"div",35)(47,"button",36),s(48,"Close"),n(),o(49,"button",37),_("click",function(){return f(l),h(t.saveCroppedImage())}),s(50,"Save changes"),n()()()()(),o(51,"div",38)(52,"div",25)(53,"div",26)(54,"div",27)(55,"h5",39),s(56,"Profile Photo"),n(),d(57,"button",29),n(),o(58,"div",30)(59,"div",10)(60,"button",11),_("click",function(){return f(l),h(t.openImageCropperDialog())}),d(61,"i",12),s(62),n(),C(63,Se,2,0,"button",13),n()(),o(64,"div",35)(65,"button",36),s(66,"Close"),n()()()()()}r&2&&(a(7),m("maxWPX",140),a(),N("alt",t.user.firstname),m("src",t.imageUrl,D)("ngClass",U(19,he,t.user.image)),a(3),m("ngClass",U(21,oe,t.user.image)),a(),m("ngClass",F(23,le,t.user.image,!t.user.image)),a(),x(t.user.image?"Change\xA0Photo":"Add\xA0Photo"),a(),m("ngIf",t.user.image),a(5),u("",t.user.firstname+" "+t.user.lastname," "),a(2),x(t.user.username),a(2),u("Mobile: ",t.user.mobile,""),a(2),u("Email: ",t.user.email,""),a(2),u("Roles: ",t.user.roles,""),a(),m("ngIf",t.village),a(15),m("formGroup",t.profilePictureForm),a(17),m("ngClass",U(26,oe,t.user.image)),a(),m("ngClass",F(28,le,t.user.image,!t.user.image)),a(),x(t.user.image?"Change\xA0Photo":"Add\xA0Photo"),a(),m("ngIf",t.user.image))},dependencies:[R,j,L,H,G,q,O,X,J,te,$]})}}return i})();var ye=[{path:"",component:de,data:{title:"User Profile",breadcrumb:"User Profile"},children:[{path:"",pathMatch:"full",redirectTo:"view"},{path:"view",loadChildren:()=>import("./chunk-U2CJIYQ5.js").then(i=>i.ViewProfileModule)},{path:"edit",loadChildren:()=>import("./chunk-3J4TAHVT.js").then(i=>i.EditProfileModule)}]}],ce=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275mod=y({type:i})}static{this.\u0275inj=S({imports:[V.forChild(ye),V]})}}return i})();var Oe=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275mod=y({type:i})}static{this.\u0275inj=S({imports:[B,ce,Y,Z,ae]})}}return i})();export{Oe as UserProfileModule};
