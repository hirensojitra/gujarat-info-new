import{a as g}from"./chunk-54PNBTSE.js";import{a as k}from"./chunk-ZP3YR75T.js";import{a as d}from"./chunk-XKZP7YFN.js";import{u as m}from"./chunk-RACBT6AO.js";import{A as l,N as p,ja as f,oa as a,u as r}from"./chunk-PDE6R37N.js";var I=(()=>{class t{constructor(n,i,o,s){this.platform=n,this.authCookie=i,this.rolesService=o,this.router=s}canActivate(n,i){if(!this.platform.isBrowser())return r(!1);let o=i.url;if(!this.authCookie.isLoggedIn())return r(this.router.createUrlTree(["/authentication/login"],{queryParams:{returnUrl:o}}));let s=this.authCookie.getToken()||"",h;try{let e=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");h=JSON.parse(atob(e))}catch{return r(this.router.createUrlTree(["/authentication/login"],{queryParams:{returnUrl:o}}))}let v=String(h.role_id),c=n.data.roleCode||[];return c.length?this.rolesService.getRoles().pipe(l(e=>e.filter(u=>c.includes(u.code))),l(e=>e.length?e.some(u=>u.id===v)?!0:this.router.createUrlTree(["/broken-pages/unauthorized"],{queryParams:{returnUrl:o,expected:c.join(",")}}):this.router.createUrlTree(["/broken-pages/unauthorized"])),p(()=>r(this.router.createUrlTree(["/broken-pages/unauthorized"])))):r(!0)}static{this.\u0275fac=function(i){return new(i||t)(a(d),a(k),a(g),a(m))}}static{this.\u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();export{I as a};
