import{a as J}from"./chunk-KYNNVPTE.js";import{A as Y,B as z,C as O,E as U,O as H,h as L,i as v,j as D,k as G,o as q,s as A,v as B}from"./chunk-FUQC5WGJ.js";import{a as N}from"./chunk-PSLVHKNI.js";import"./chunk-S2AHCA5Z.js";import"./chunk-CBCLPHDX.js";import{a as j}from"./chunk-IHGCADJY.js";import"./chunk-WVD7KDO5.js";import{Aa as g,E as p,Ha as n,Hb as F,J as R,Ja as x,Jb as E,K as u,Kb as M,Lb as S,P as k,Q as C,aa as a,ba as m,gb as I,la as P,m as y,na as d,nb as V,ta as r,ua as s,va as f,w as T,wa as h,xa as w,ya as _,za as b}from"./chunk-VTNAYE3H.js";import{f as c}from"./chunk-CWTPBX7D.js";function ee(e,l){e&1&&(h(0),r(1,"p"),n(2,"Checking your reset token..."),s(),w())}function te(e,l){e&1&&(h(0),r(1,"p"),n(2,"You can set your new password now."),s(),w())}function ie(e,l){e&1&&(h(0),r(1,"p",10),n(2,"Your reset token has expired or is invalid."),s(),w())}function oe(e,l){if(e&1){let t=_();r(0,"form",11),b("ngSubmit",function(){k(t);let i=g();return C(i.onSubmit())}),r(1,"div",12)(2,"label",13),n(3,"New Password"),s(),f(4,"input",14),s(),r(5,"div",12)(6,"label",15),n(7,"Confirm New Password"),s(),f(8,"input",16),s(),r(9,"button",17),n(10),s()()}if(e&2){let t=g();d("formGroup",t.resetPasswordForm),a(9),d("disabled",t.isLoading||t.resetPasswordForm.invalid),a(),x(" ",t.isLoading?"Resetting...":"Reset Password"," ")}}function re(e,l){if(e&1){let t=_();r(0,"div",8)(1,"button",18),b("click",function(){k(t);let i=g();return C(i.navigateToForgotPassword())}),n(2,"Go to Forgot Password"),s()()}}var Q=(()=>{class e{constructor(t,o,i,X,Z,$){this.fb=t,this.route=o,this.router=i,this.authService=X,this.toast=Z,this.platformService=$,this.isLoading=!1,this.isTokenValid=!0,this.isTokenChecked=!1}ngOnInit(){return c(this,null,function*(){})}ngAfterViewInit(){return c(this,null,function*(){if(this.platformService.isBrowser()){debugger;this.token=this.route.snapshot.queryParams.token,this.email=this.route.snapshot.queryParams.email,yield this.validateToken(),this.resetPasswordForm=this.fb.group({password:["",[v.required,v.minLength(6)]],confirmPassword:["",[v.required]]},{validator:this.passwordsMatchValidator})}})}validateToken(){return c(this,null,function*(){try{let t=yield y(this.authService.validateResetToken(this.token,this.email).pipe(T(()=>this.isTokenChecked=!0)));this.isTokenValid=t.success}catch(t){this.toast.show(t,{class:"bg-danger"}),this.isTokenValid=!1}})}passwordsMatchValidator(t){return t.get("password").value===t.get("confirmPassword").value?null:{mismatch:!0}}onSubmit(){if(this.resetPasswordForm.invalid)return;this.isLoading=!0;let t=this.resetPasswordForm.get("password").value;this.authService.resetPassword(this.token,this.email,t).subscribe(o=>{this.isLoading=!1,this.toast.show("Password reset successfully",{class:"bg-success"}),this.router.navigate(["/login"])},o=>{this.isLoading=!1,o==="Token expired"?(this.toast.show("Reset token has expired. Please request a new one.",{class:"bg-danger"}),this.router.navigate(["/auth/forgot-password"])):this.toast.show("Error resetting password",{class:"bg-danger"})})}navigateToForgotPassword(){this.router.navigate(["/auth/forgot-password"])}static{this.\u0275fac=function(o){return new(o||e)(m(Y),m(F),m(E),m(N),m(J),m(j))}}static{this.\u0275cmp=R({type:e,selectors:[["app-reset-password"]],decls:17,vars:7,consts:[[1,"container","d-flex","align-items-center","justify-content-center","min-vh-100"],[1,"card","shadow","p-4",2,"width","400px","border-radius","15px"],[1,"text-center","mb-4"],["src","assets/images/svg/logo.svg","alt","logo",2,"width","60px"],[1,"mt-3"],[4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],["class","text-center mt-3",4,"ngIf"],[1,"text-center","mt-3"],[1,"text-decoration-none",3,"routerLink"],[1,"text-danger"],[3,"ngSubmit","formGroup"],[1,"form-group","mb-3"],["for","password",1,"form-label"],["type","password","id","password","formControlName","password","placeholder","Enter new password",1,"form-control"],["for","confirmPassword",1,"form-label"],["type","password","id","confirmPassword","formControlName","confirmPassword","placeholder","Confirm new password",1,"form-control"],["type","submit",1,"btn","btn-dark","w-100",3,"disabled"],[1,"btn","btn-dark","w-100",3,"click"]],template:function(o,i){o&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),f(3,"img",3),r(4,"h4",4),n(5,"Reset Password"),s(),n(6),P(7,ee,3,0,"ng-container",5)(8,te,3,0,"ng-container",5)(9,ie,3,0,"ng-container",5),s(),P(10,oe,11,3,"form",6)(11,re,3,0,"div",7),r(12,"div",8)(13,"p"),n(14,"Don't have an account yet? "),r(15,"a",9),n(16,"Sign Up"),s()()()()()),o&2&&(a(6),x(" ",i.isTokenChecked+" -- "+i.isTokenValid," "),a(),d("ngIf",!i.isTokenChecked),a(),d("ngIf",i.isTokenChecked&&i.isTokenValid),a(),d("ngIf",i.isTokenChecked&&!i.isTokenValid),a(),d("ngIf",i.isTokenChecked&&i.isTokenValid),a(),d("ngIf",i.isTokenChecked&&!i.isTokenValid),a(4),d("routerLink","/auth/register"))},dependencies:[I,M,q,L,D,G,A,B,U]})}}return e})();var se=[{path:"",component:Q,data:{title:"Reset Password",description:"Reset your password using email",keywords:"Forgot password, reset password",robots:"noindex, nofollow"}}],W=(()=>{class e{static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275mod=u({type:e})}static{this.\u0275inj=p({imports:[S.forChild(se),S]})}}return e})();var ye=(()=>{class e{static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275mod=u({type:e})}static{this.\u0275inj=p({imports:[V,W,z,O,H]})}}return e})();export{ye as ResetPasswordModule};
