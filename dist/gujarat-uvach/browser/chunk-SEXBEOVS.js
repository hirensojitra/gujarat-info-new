import{a as Me}from"./chunk-ZDCKU4GH.js";import{l as Se,n as T}from"./chunk-FPGXSDDP.js";import{a as U}from"./chunk-RS47H25V.js";import"./chunk-APHECYKI.js";import{a as le,g as be,r as Ce}from"./chunk-PBJOXYUL.js";import{a as oe}from"./chunk-WIB4C2YZ.js";import"./chunk-5Q7Z4NCA.js";import{c as me,d as y,f as se,g as de,k as ce,o as pe,r as ue,s as fe,t as ge,u as ve,x as _e,y as he,z as xe}from"./chunk-VHQPGRHI.js";import{x as D}from"./chunk-ZHFQYQGD.js";import{$a as q,$b as l,$c as ee,Aa as b,Ib as n,Jb as i,Kb as c,Lb as V,Mb as k,Nb as S,Pb as _,Rb as p,Ub as Q,Xb as H,Yb as X,Yc as J,Zb as Y,Zc as K,_c as Z,ac as u,ad as te,bc as C,bd as ie,eb as a,ed as ne,fa as B,fb as w,fd as re,ga as E,hd as ae,jc as P,ka as A,kc as O,mc as F,nc as N,qa as G,ra as I,wb as g,xb as z,yb as m,z as M,za as x,zb as W}from"./chunk-KKPMMK4Z.js";import{c as j,e as Te}from"./chunk-CWTPBX7D.js";var L=function(t){return t.MALE="MALE",t.FEMALE="FEMALE",t.NONBINARY="NONBINARY",t.OTHER="OTHER",t}(L||{}),R=function(t){return t.SINGLE="SINGLE",t.MARRIED="MARRIED",t.DIVORCED="DIVORCED",t.WIDOWED="WIDOWED",t}(R||{});var we=Te(Me());var ye=T`
  mutation UpdateUserProfile($input: UpdateUserInput!, $image: Upload) {
    updateUserProfile(input: $input, image: $image) {
      id
      firstname
      lastname
      middlename
      email
      number
      number_verified
      gender
      birthday
      marital_status
      role_id
      language {
        id
        name
      }
    }
  }
`;var Ee=T`
  query GetLanguages {
    languages {
      id
      name
    }
  }
`;var Ie=(()=>{class t{constructor(e,r){this.apollo=e,this.authenticationService=r}refetchCurrentUser(){this.userQuery?.refetch()}updateProfile(e){let r=this.authenticationService.getToken(),f=e,{image:o}=f,s=j(f,["image"]);return this.apollo.mutate({mutation:ye,variables:{input:s,image:o},context:{headers:{Authorization:`Bearer ${r}`}}}).pipe(M(v=>v.data.updateUserProfile))}getLanguages(){return this.apollo.watchQuery({query:Ee}).valueChanges.pipe(M(({data:e})=>e.languages))}static{this.\u0275fac=function(r){return new(r||t)(A(Se),A(U))}}static{this.\u0275prov=B({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var ke=["imageInput"],Pe=t=>({"me-2":t}),Fe=(t,d)=>({"fa-pencil":t,"fa-plus":d}),Oe=t=>({"img-thumbnail rounded-circle":t});function De(t,d){if(t&1){let e=S();n(0,"button",34),_("click",function(){x(e);let o=p(2);return b(o.deleteImage())}),c(1,"i",35),i()}}function Le(t,d){if(t&1&&(n(0,"div",40)(1,"div",41),c(2,"i",56),i(),n(3,"div")(4,"div",43),l(5,"Name"),i(),n(6,"div",57)(7,"div",58),l(8),i(),n(9,"div",58),l(10),i(),n(11,"div",58),l(12),i()()()()),t&2){let e=p(3);a(8),u(e.user.firstname),a(2),u(e.user.middlename),a(2),u(e.user.lastname)}}function Re(t,d){if(t&1&&(n(0,"div",40)(1,"div",49),c(2,"i",50),i(),n(3,"div")(4,"div",43),l(5,"Number Verified"),i(),n(6,"div",44),l(7),i()()()),t&2){let e=p(3);a(),m("ngClass",e.user.number_verified?"text-success":"text-danger"),a(),m("ngClass",e.user.number_verified?"fa-check":"fa-close"),a(5),u(e.user.number_verified)}}function $e(t,d){if(t&1&&(n(0,"div",40)(1,"div",54),c(2,"i",59),i(),n(3,"div")(4,"div",43),l(5,"Birthday"),i(),n(6,"div",44),l(7),i()()()),t&2){let e=p(3);a(7),u(e.user.birthday)}}function je(t,d){if(t&1&&(n(0,"div",40)(1,"div",54),c(2,"i",60),i(),n(3,"div")(4,"div",43),l(5,"Gender"),i(),n(6,"div",44),l(7),i()()()),t&2){let e=p(3);a(7),u(e.user.gender)}}function Be(t,d){if(t&1&&(n(0,"div",40)(1,"div",54),c(2,"i",61),i(),n(3,"div")(4,"div",43),l(5,"Marital Status"),i(),n(6,"div",44),l(7),i()()()),t&2){let e=p(3);a(7),u(e.user.marital_status)}}function Ge(t,d){if(t&1&&(n(0,"div",36)(1,"div",37)(2,"div",38),g(3,Le,13,3,"div",39),n(4,"div",40)(5,"div",41),c(6,"i",42),i(),n(7,"div")(8,"div",43),l(9,"ID"),i(),n(10,"div",44),l(11),i()()(),n(12,"div",40)(13,"div",45),c(14,"i",46),i(),n(15,"div")(16,"div",43),l(17,"Mobile Number"),i(),n(18,"div",44),l(19),i()()(),g(20,Re,8,3,"div",39),n(21,"div",40)(22,"div",47),c(23,"i",48),i(),n(24,"div")(25,"div",43),l(26,"Email"),i(),n(27,"div",44),l(28),i()()(),n(29,"div",40)(30,"div",49),c(31,"i",50),i(),n(32,"div")(33,"div",43),l(34,"Email Verified"),i(),n(35,"div",44),l(36),i()()(),n(37,"div",40)(38,"div",51),c(39,"i",52),i(),n(40,"div")(41,"div",43),l(42,"Role ID"),i(),n(43,"div",44),l(44),i()()(),n(45,"div",40)(46,"div",41),c(47,"i",53),i(),n(48,"div")(49,"div",43),l(50,"Username"),i(),n(51,"div",44),l(52),i()()(),g(53,$e,8,1,"div",39)(54,je,8,1,"div",39)(55,Be,8,1,"div",39),n(56,"div",40)(57,"div",54),c(58,"i",55),i(),n(59,"div")(60,"div",43),l(61,"Language"),i(),n(62,"div",44),l(63),i()()()()()()),t&2){let e=p(2);a(3),m("ngIf",e.user.firstname||e.user.lastname||e.user.middlename),a(8),u(e.user.id),a(8),u(e.user.number||"Not Updated"),a(),m("ngIf",e.user.number),a(8),u(e.user.email),a(2),m("ngClass",e.user.email?"text-success":"text-danger"),a(),m("ngClass",e.user.email_verified?"fa-check":"fa-close"),a(5),u(e.user.email_verified),a(8),u(e.user.role_id),a(8),u(e.user.username||"Not Uvailable"),a(),m("ngIf",e.user.birthday),a(),m("ngIf",e.user.gender),a(),m("ngIf",e.user.marital_status),a(8),u(e.user.language.name)}}function qe(t,d){if(t&1&&(n(0,"option",76),l(1),F(2,"titlecase"),i()),t&2){let e=d.$implicit;m("value",e),a(),C(" ",N(2,2,e)," ")}}function ze(t,d){if(t&1&&(n(0,"select",73)(1,"option",74),l(2,"-- Select Gender --"),i(),g(3,qe,3,4,"option",75),i()),t&2){let e=p().$implicit,r=p(3);m("id",e.name)("formControlName",e.name),a(),m("ngValue",null),a(2),m("ngForOf",r.genderOptions)}}function We(t,d){if(t&1&&(n(0,"option",76),l(1),F(2,"titlecase"),i()),t&2){let e=d.$implicit;m("value",e),a(),C(" ",N(2,2,e)," ")}}function Qe(t,d){if(t&1&&(n(0,"select",73)(1,"option",74),l(2,"-- Select Marital Status --"),i(),g(3,We,3,4,"option",75),i()),t&2){let e=p().$implicit,r=p(3);m("id",e.name)("formControlName",e.name),a(),m("ngValue",null),a(2),m("ngForOf",r.maritalStatusOptions)}}function He(t,d){if(t&1&&(n(0,"option",76),l(1),i()),t&2){let e=d.$implicit;m("value",e.id),a(),C(" ",e.name," ")}}function Xe(t,d){if(t&1&&(n(0,"select",77)(1,"option",74),l(2,"-- Select Language --"),i(),g(3,He,2,2,"option",75),i()),t&2){let e=p().$implicit,r=p(3);m("formControlName",e.name),a(),m("ngValue",null),a(2),m("ngForOf",r.languageOptions)}}function Ye(t,d){if(t&1&&c(0,"input",78),t&2){let e=p().$implicit;m("type",e.type)("id",e.name)("formControlName",e.name)}}function Je(t,d){if(t&1&&(V(0),n(1,"div",67)(2,"label",68),l(3),i(),V(4,69),g(5,ze,4,4,"select",70)(6,Qe,4,4,"select",70)(7,Xe,4,3,"select",71)(8,Ye,1,3,"input",72),k(),i(),k()),t&2){let e=d.$implicit;a(2),m("for",e.name),a(),u(e.label),a(),m("ngSwitch",e.name),a(),m("ngSwitchCase","gender"),a(),m("ngSwitchCase","marital_status"),a(),m("ngSwitchCase","language_id")}}function Ke(t,d){if(t&1){let e=S();n(0,"div")(1,"form",62),_("ngSubmit",function(){x(e);let o=p(2);return b(o.onSubmit())}),n(2,"div",63),g(3,Je,9,6,"ng-container",64),i(),n(4,"button",65),l(5," Save "),i(),n(6,"button",66),_("click",function(){x(e);let o=p(2);return b(o.toggleEdit())}),l(7," Cancel "),i()()()}if(t&2){let e=p(2);a(),m("formGroup",e.profileForm),a(2),m("ngForOf",e.formFields),a(),m("disabled",e.profileForm.invalid)}}function Ze(t,d){if(t&1){let e=S();n(0,"div",21)(1,"pre"),l(2),F(3,"json"),i(),n(4,"div",22)(5,"div",23)(6,"div",24),c(7,"img",25),n(8,"input",26,0),_("change",function(o){x(e);let s=p();return b(s.handleImageInputChange(o))}),i()()(),n(10,"div",23)(11,"div",17)(12,"button",18),_("click",function(){x(e);let o=p();return b(o.openImageCropperDialog())}),c(13,"i",19),l(14),i(),g(15,De,2,0,"button",20),i()()(),g(16,Ge,64,14,"div",27)(17,Ke,8,3,"div",28),n(18,"div",29)(19,"div",30)(20,"div",31)(21,"div",32),l(22),i()()(),n(23,"button",33),_("click",function(){x(e);let o=p();return b(o.toggleEdit())}),l(24),i()()()}if(t&2){let e=p();a(2),u(N(3,16,e.user)),a(4),m("maxWPX",140),a(),Q("alt",e.user.firstname),m("src",e.imageUrl,q)("ngClass",P(18,Oe,e.user.image)),a(5),m("ngClass",P(20,Pe,e.user.image)),a(),m("ngClass",O(22,Fe,e.user.image,!e.user.image)),a(),u(e.user.image?"Change\xA0Photo":"Add\xA0Photo"),a(),m("ngIf",e.user.image),a(),m("ngIf",!e.editing),a(),m("ngIf",e.editing),a(4),W("width",e.completion,"%"),z("aria-valuenow",e.completion),a(),C(" ",e.completion,"% "),a(2),C(" ",e.editing?"Cancel":e.completion<100?"Complete Profile":"Edit Profile"," ")}}function et(t,d){if(t&1){let e=S();n(0,"button",34),_("click",function(){x(e);let o=p();return b(o.deleteImage())}),c(1,"i",35),i()}}var Ne=(()=>{class t{constructor(e,r,o){this.authService=e,this.updateUserService=r,this.fb=o,this.user=null,this.editing=!1,this.completion=0,this.genderOptions=Object.values(L),this.maritalStatusOptions=Object.values(R),this.languageOptions=[],this.imageUrl="",this.formFields=[{name:"firstname",label:"First Name",type:"text",validators:[y.required]},{name:"middlename",label:"Middle Name",type:"text",validators:[]},{name:"lastname",label:"Last Name",type:"text",validators:[y.required]},{name:"number",label:"Mobile Number",type:"tel",validators:[y.required]},{name:"birthday",label:"Birthday",type:"date",validators:[]},{name:"gender",label:"Gender",type:"select",validators:[]},{name:"marital_status",label:"Marital Status",type:"select",validators:[]},{name:"language_id",label:"Language",type:"select",validators:[]}],this.apiUrl=oe.MasterApi+"/auth/avatar/"}ngOnInit(){this.sub=this.authService.user$.subscribe(e=>{this.user=e,this.calculateCompletion(),this.editing&&this.buildForm(),this.validateImage(this.user.id)}),this.updateUserService.getLanguages().subscribe(e=>{this.languageOptions=e}),this.cropperModal=new bootstrap.Modal(document.getElementById("cropperModal"),{focus:!1,keyboard:!1,static:!1}),this.cropperModal._element.addEventListener("hide.bs.modal",()=>{this.cropper&&this.cropper.destroy()}),this.cropperModal._element.addEventListener("show.bs.modal",()=>{}),this.imageSelect=new bootstrap.Modal(document.getElementById("imageSelect"),{focus:!1,keyboard:!1,static:!1}),this.imageSelect._element.addEventListener("hidden.bs.modal",()=>{let e=this.imageInput.nativeElement;e.files&&e.files.length>0||this.imageSelect.show()}),this.profilePictureForm=this.fb.group({image:["",y.required]})}ngOnDestroy(){this.sub?.unsubscribe()}toggleEdit(){this.editing=!this.editing,this.editing&&this.buildForm()}buildForm(){let e={};this.formFields.forEach(r=>{let o="";this.user&&(r.name==="language_id"?o=this.user.language.id:o=this.user[r.name]??""),e[r.name]=[o,r.validators]}),this.profileForm=this.fb.group(e)}calculateCompletion(){if(!this.user){this.completion=0;return}let e=this.formFields.map(s=>s.name),r=e.length,o=e.reduce((s,f)=>f==="language_id"?this.user.language.id?s+1:s:this.user[f]?s+1:s,0);this.completion=Math.round(o/r*100)}onSubmit(){if(this.profileForm.invalid||!this.user)return;let e=this.profileForm.value,r={},o=!1;for(let[s,f]of Object.entries(e))if(!(f===""||f==null))if(s==="language_id")f!==this.user.language.id&&(r[s]=f);else{let v=this.user[s];String(f)!==String(v)&&(r[s]=f,s==="number"&&(o=!0))}if(o&&(r.number=e.number),!Object.keys(r).length){this.editing=!1;return}this.updateUserService.updateProfile(r).subscribe(s=>{this.authService.setUser(s),this.editing=!1})}openImageCropperDialog(){let e=this.imageInput.nativeElement;e&&(e.value="",e.click())}handleImageInputChange(e){let o=e.target.files?.[0];if(o&&(o.type==="image/jpeg"||o.type==="image/png")){this.imageSelect.hide();let s=new FileReader;s.onload=f=>{let v=f.target?.result;this.cropperModal.show();let h=document.getElementById("cropper");this.cropper=new we.default(h,{aspectRatio:1,scalable:!0,viewMode:1,crop:it=>{},autoCropArea:1,dragMode:"move",responsive:!0,cropBoxResizable:!1,minCropBoxWidth:320,minCropBoxHeight:320,minContainerWidth:320,minContainerHeight:320}),this.cropper.replace(v)},s.readAsDataURL(o)}else this.imageSelect.show()}handleCropEvent(){if(this.cropper){let e=this.cropper.getCroppedCanvas(),r=document.createElement("canvas"),o=r.getContext("2d");r.width=320,r.height=320,o.drawImage(e,0,0,320,320);let s=r.toDataURL("image/png");this.profilePictureForm.get("image")?.setValue(s)}}saveCroppedImage(){if(this.handleCropEvent(),this.profilePictureForm.valid){let e=this.profilePictureForm.value;if(e.image){let r=this.base64ToFile(e.image,`profile-picture-${Date.now()}.png`);this.isUploading=!0,this.updateUserService.updateProfile({image:r}).subscribe({next:o=>{this.authService.setUser(o),this.cropperModal.hide(),this.isUploading=!1,this.profilePictureForm.reset(),this.validateImage(o.username||this.user?.username)},error:o=>{console.error("Failed to update image:",o),this.isUploading=!1}})}}}base64ToFile(e,r){let o=e.split(","),s=o[0].match(/:(.*?);/)[1],f=atob(o[1]),v=f.length,h=new Uint8Array(v);for(;v--;)h[v]=f.charCodeAt(v);return new File([h],r,{type:s})}validateImage(e){let r=`?v=${new Date().getTime()}`,o=e?`${this.apiUrl+e}${r}`:`https://dummyimage.com/300x300/F4F4F4/000000&text=${this.imageText()}`;this.imageUrl=o;let v=this.authService.getUser()?.image?.split("?")[0],h=o.split("?")[0];h&&v!==h&&this.authService.setImageUrl(h)}imageText(){if(this.user&&this.user.firstname&&this.user.lastname){let e=this.user.firstname.charAt(0),r=this.user.lastname.charAt(0);return` ${e}${r} `}else return"USER"}deleteImage(){if(!this.user)return;let e=new File(["delete"],"delete.txt",{type:"text/plain"});this.isUploading=!0,this.updateUserService.updateProfile({image:e}).subscribe({next:r=>{this.authService.setUser(r),this.imageUrl=`https://dummyimage.com/300x300/F4F4F4/000000&text=${this.imageText()}`,this.isUploading=!1},error:r=>{console.error("Failed to delete image:",r),this.isUploading=!1}})}static{this.\u0275fac=function(r){return new(r||t)(w(U),w(Ie),w(_e))}}static{this.\u0275cmp=G({type:t,selectors:[["app-profile"]],viewQuery:function(r,o){if(r&1&&H(ke,5),r&2){let s;X(s=Y())&&(o.imageInput=s.first)}},decls:33,vars:11,consts:[["imageInput",""],["class","container my-5",4,"ngIf"],["id","cropperModal","tabindex","-1","aria-labelledby","cropperModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],["id","cropperModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["id","cropper","alt","Crop",1,"w-100"],[3,"formGroup"],["type","hidden","formControlName","image"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary",3,"click"],["id","imageSelect","tabindex","-1","aria-labelledby","imageSelectLabel","aria-hidden","true",1,"modal","fade"],["id","imageSelectLabel",1,"modal-title"],[1,"d-flex","align-items-center","justify-content-center"],[1,"btn","btn-primary","btn-sm",3,"click","ngClass"],[1,"fa","me-2",3,"ngClass"],["class","btn btn-danger btn-sm",3,"click",4,"ngIf"],[1,"container","my-5"],[1,"row","g-3","align-items-center"],[1,"col-md-12"],["remSize","",1,"mx-auto",3,"maxWPX"],[1,"w-100",3,"src","ngClass","alt"],["type","file",2,"display","none",3,"change"],["class","card mx-auto shadow-lg","style","max-width:900px; border-radius:1rem; overflow:hidden;",4,"ngIf"],[4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","my-4"],[1,"flex-grow-1","me-3"],[1,"progress"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-danger","btn-sm",3,"click"],[1,"fa","fa-trash"],[1,"card","mx-auto","shadow-lg",2,"max-width","900px","border-radius","1rem","overflow","hidden"],[1,"card-body","px-4","pt-4"],[1,"row","gx-2"],["class","col-md-6 d-flex align-items-center pb-2 mb-2 border-bottom",4,"ngIf"],[1,"col-md-6","d-flex","align-items-center","pb-2","mb-2","border-bottom"],[1,"icon-circle","bg-white","text-primary","me-3"],[1,"fa","fa-id-card"],[1,"fw-bold"],[1,"text-muted","small"],[1,"icon-circle","bg-white","text-success","me-3"],[1,"fa","fa-phone"],[1,"icon-circle","bg-white","text-warning","me-3"],[1,"fa","fa-envelope"],[1,"icon-circle","bg-white","me-3",3,"ngClass"],[1,"fa",3,"ngClass"],[1,"icon-circle","bg-white","text-info","me-3"],[1,"fa","fa-tag"],[1,"fa","fa-user-circle"],[1,"icon-circle","bg-white","text-secondary","me-3"],[1,"fa","fa-language"],[1,"fa","fa-user"],[1,"d-flex"],[1,"text-muted","small","me-2"],[1,"fa","fa-calendar"],[1,"fa","fa-venus-mars"],[1,"fa","fa-users"],[1,"mx-auto",2,"max-width","900px",3,"ngSubmit","formGroup"],[1,"row"],[4,"ngFor","ngForOf"],["type","submit",1,"btn","btn-success","me-2",3,"disabled"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"col-md-6","mb-3"],[1,"form-label",3,"for"],[3,"ngSwitch"],["class","form-select",3,"id","formControlName",4,"ngSwitchCase"],["class","form-select",3,"formControlName",4,"ngSwitchCase"],["class","form-control",3,"type","id","formControlName",4,"ngSwitchDefault"],[1,"form-select",3,"id","formControlName"],[3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"form-select",3,"formControlName"],[1,"form-control",3,"type","id","formControlName"]],template:function(r,o){r&1&&(g(0,Ze,25,25,"div",1),n(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"h5",6),l(6,"Profile Photo"),i(),c(7,"button",7),i(),n(8,"div",8),c(9,"img",9),n(10,"form",10),c(11,"input",11),i()(),n(12,"div",12)(13,"button",13),l(14,"Close"),i(),n(15,"button",14),_("click",function(){return o.saveCroppedImage()}),l(16,"Save changes"),i()()()()(),n(17,"div",15)(18,"div",3)(19,"div",4)(20,"div",5)(21,"h5",16),l(22,"Profile Photo"),i(),c(23,"button",7),i(),n(24,"div",8)(25,"div",17)(26,"button",18),_("click",function(){return o.openImageCropperDialog()}),c(27,"i",19),l(28),i(),g(29,et,2,0,"button",20),i()(),n(30,"div",12)(31,"button",13),l(32,"Close"),i()()()()()),r&2&&(m("ngIf",o.user),a(10),m("formGroup",o.profilePictureForm),a(16),m("ngClass",P(6,Pe,o.user.image)),a(),m("ngClass",O(8,Fe,o.user.image,!o.user.image)),a(),u(o.user.image?"Change\xA0Photo":"Add\xA0Photo"),a(),m("ngIf",o.user.image))},dependencies:[J,K,Z,ee,te,ie,ce,ge,ve,me,fe,se,de,pe,ue,be,le,re,ne]})}}return t})();var tt=[{path:"",component:Ne,data:{title:"",description:"",keywords:"",robots:""}}],Ue=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=I({type:t})}static{this.\u0275inj=E({imports:[D.forChild(tt),D]})}}return t})();var Ut=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=I({type:t})}static{this.\u0275inj=E({imports:[ae,Ue,he,xe,Ce]})}}return t})();export{Ut as ProfileModule};
