import{c as Y,d as h,f as J,g as K,k as Z,o as ee,r as te,v as re,w as P,x as ie,y as oe}from"./chunk-2V5UGUD5.js";import{a as X}from"./chunk-QHXDM6TZ.js";import{$ as j,Aa as I,Ea as _,F as M,Fa as T,G as k,Ga as D,I as F,Ia as w,Ib as O,Ka as H,L as q,M as U,Mb as G,R as x,S as C,T as L,U as $,ba as b,ca as S,f as V,fa as N,oa as y,ob as Q,ua as m,ub as W,va as g,wa as p,za as z}from"./chunk-6PSXH6NM.js";var ae=(()=>{class n{constructor(e){this.http=e,this.baseUrl=X.MasterApi+"/posts"}getAllPosts(e){return this.http.get(`${this.baseUrl}?page=${e}`)}addPost(e){return console.log(`${this.baseUrl}`),this.http.post(`${this.baseUrl}`,e)}getPostById(e){return console.log(`${this.baseUrl}/get/${e}`),this.http.get(`${this.baseUrl}/get/${e}`)}updatePost(e){return this.http.put(`${this.baseUrl}/update/`,e)}softDeletePost(e){return this.http.delete(`${this.baseUrl}/soft-delete/${e}`)}hardDeletePost(e){return this.http.delete(`${this.baseUrl}/hard-delete/${e}`)}getAllSoftDeletedPosts(e){return this.http.get(`${this.baseUrl}/soft-deleted/?page=${e}`)}getTotalPostLength(){return this.http.get(`${this.baseUrl}/post-length`)}getTotalDeletedPostLength(){return this.http.get(`${this.baseUrl}/post-deleted-length`)}static{this.\u0275fac=function(t){return new(t||n)(F(W))}}static{this.\u0275prov=M({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var se=(()=>{class n{constructor(e){this.fb=e}rgbToHex(e,t,r){return"#"+((1<<24)+(e<<16)+(t<<8)+r).toString(16).slice(1)}makeDataForImage(e){let{w:t,h:r,backgroundurl:o,data:d}=e.details;return{svgWidth:t||0,svgHeight:r||0,background:o||"",viewBox:"0 0 "+(t||0)+" "+(r||0),elements:d.map((s,i)=>{if(s.type==="text_group")return{index:i,type:"text_group",data:s.data.map((a,u)=>({index:u,type:a.type,x:a.x,y:a.y,fs:a.fs,fw:a.fw,fontStyle:{italic:a.fontStyle?.italic||!1,underline:a.fontStyle?.underline||!1},textAlign:a.textAlign||"",color:a.color||""}))};if(s.type==="avatar"){let c=s;return{index:i,type:"avatar",r:c.r||0,borderwidth:c.borderwidth||0,bordercolor:c.bordercolor||"",imageUrl:c.imageUrl||"assets/images/svg/upload-img.svg",x:c.x||0,y:c.y||0}}else if(s.type==="name"||s.type==="address"){let c=s;return{index:i,type:c.type,x:c.x,y:c.y,fs:c.fs,text:c.text,fw:c.fw,fontStyle:{italic:s.fontStyle?.italic||!1,underline:s.fontStyle?.underline||!1},textAlign:s.textAlign||"",color:s.color||""}}else return{index:i}}).filter(s=>s!==null)}}textPosition(e){switch(e){case"center":return"middle";case"left":return"start";case"right":return"end";default:return"middle"}}setData(e,t){if(t instanceof re){let r=t.controls[e.index];r.get("x")?.setValue(e.x,{emitEvent:!1}),r.get("y")?.setValue(e.y,{emitEvent:!1})}}addAvatarControls(e){let t=this.fb.group({type:["avatar"],r:[100,h.required],borderwidth:[10,h.required],bordercolor:["#FFF",h.required],x:[300,h.required],y:[300,h.required],imageUrl:[""]});e.push(t)}createFormControlGroup(e){return this.fb.group({type:[e],x:[10,h.required],y:[10,h.required],fs:[30,h.required],fw:"400",fontStyle:this.fb.group({italic:[!1],underline:[!1]}),textAlign:["center",h.required],color:["#FFF",h.required],text:""})}addNameControls(e){let t=this.createFormControlGroup("name");e.push(t)}addAddressControls(e){let t=this.createFormControlGroup("address");e.push(t)}addTextGroupControls(e){let t=this.fb.group({type:["text_group"],data:this.fb.array([this.createFormControlGroup("name"),this.createFormControlGroup("address")])});e.push(t)}removeControls(e,t){for(let r=t.length-1;r>=0;r--)t.at(r).get("type")?.value===e&&t.removeAt(r)}addControlsByType(e,t){let r=t.get("data");switch(e){case"avatar":this.addAvatarControls(r);break;case"name":this.addNameControls(r);break;case"address":this.addAddressControls(r);break;case"text_group":this.addTextGroupControls(r);break;default:break}}removeControlsByType(e,t){let r=t.get("data");switch(e){case"avatar":this.removeControls("avatar",r);break;case"name":this.removeControls("name",r);break;case"address":this.removeControls("address",r);break;case"text_group":this.removeControls("text_group",r);break;default:break}}getMousePosition(e,t){e.preventDefault();let r="touches"in e?e.touches[0]:e,o=t.getScreenCTM();return{x:(r.clientX-o.e)/o.a,y:(r.clientY-o.f)/o.d}}static{this.\u0275fac=function(t){return new(t||n)(F(P))}}static{this.\u0275prov=M({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var me=["textInput"],he=["imageDraw"],ge=["imageInput"],ne=(()=>{class n{constructor(e,t,r,o,d){this.PS=e,this.fb=t,this.renderer=r,this.IMG=o,this.route=d,this.requiredName=!0,this.requiredAvatar=!0,this.requiredAddress=!0,this.dataQuequeue=[],this.requiredValues=[],this.textModalTitle="",this.imgModalTitle="",this.getDownload=!1,this.inputTextForm=this.fb.group({text:["",h.required],id:[""]}),this.profilePictureForm=this.fb.group({id:["",h.required],image:[""]})}ngOnInit(){this.route.queryParams.subscribe(e=>{let t=e.img;t?this.getPostById(t):window.close()}),this.textModal=new bootstrap.Modal(document.getElementById("textModal"),{focus:!1,keyboard:!1,static:!1}),this.textModal._element.addEventListener("hide.bs.modal",()=>{this.inputTextForm.reset()}),this.textModal._element.addEventListener("show.bs.modal",()=>{}),this.textModal._element.addEventListener("shown.bs.modal",()=>{this.textInput.nativeElement.focus()}),this.cropperModal=new bootstrap.Modal(document.getElementById("cropperModal"),{focus:!1,keyboard:!1,static:!1}),this.cropperModal._element.addEventListener("hide.bs.modal",()=>{this.cropper&&this.cropper.destroy()}),this.cropperModal._element.addEventListener("show.bs.modal",()=>{})}getPostById(e){this.PS.getPostById(e).subscribe(t=>{console.log(t),this.ele=this.IMG.makeDataForImage(t),this.drawSVG(this.ele)})}drawSVG(e){return V(this,null,function*(){this.requiredValues=[];let{background:t,viewBox:r,elements:o}=e,d=yield this.getImageDataUrl(t),l=this.imageDraw.nativeElement;for(;l.firstChild;)l.removeChild(l.firstChild);this.renderer.setAttribute(l,"viewBox",r);let s=this.renderer.createElement("image","http://www.w3.org/2000/svg");this.renderer.setAttribute(s,"x","0"),this.renderer.setAttribute(s,"y","0"),this.renderer.setAttribute(s,"width","100%"),this.renderer.setAttribute(s,"height","100%"),this.renderer.setAttribute(s,"preserveAspectRatio","xMidYMid slice"),this.renderer.setAttribute(s,"href",d),this.renderer.appendChild(l,s),o.map((i,c)=>{if(i.type==="name"||i.type==="address"){let a=this.renderer.createElement("text","http://www.w3.org/2000/svg"),u={"data-type":i.type,x:i.x.toString(),y:i.y.toString(),"font-size":i.fs,fill:i.color,"text-anchor":this.textPosition(i.textAlign),"dominant-baseline":"reset-size"},f="",v="";i.fontStyle.underline&&(f+="underline "),i.fontStyle.italic&&(v+="italic ");let A={"-webkit-user-select":"none","font-family":"'Hind Vadodara', sans-serif","font-weight":i.fw.toString(),"text-decoration":f.trim(),"font-style":v.trim()};Object.entries(u).forEach(([E,R])=>this.renderer.setAttribute(a,E,R)),Object.entries(A).forEach(([E,R])=>{this.renderer.setStyle(a,E,R)});let de="Enter "+i.type;this.requiredValues.push({defaultValue:de.toUpperCase(),type:i.type,value:i.text.trim()||"",id:c}),i.text!==void 0&&(i.text=i.text==""?("Enter "+i.type).toUpperCase():i.text,this.renderer.appendChild(a,this.renderer.createText(i.text))),this.renderer.appendChild(l,a),a.addEventListener("click",E=>{this.setText(c)})}else if(i.type==="avatar"){let a=this.renderer.createElement("circle","http://www.w3.org/2000/svg");this.renderer.setAttribute(a,"data-type","avatar"),this.renderer.setAttribute(a,"cx",i.x.toString()),this.renderer.setAttribute(a,"cy",i.y.toString()),this.renderer.setAttribute(a,"r",i.r.toString()),this.renderer.setAttribute(a,"fill","url(#image-pattern)"),this.renderer.setAttribute(a,"stroke",i.bordercolor),this.renderer.setAttribute(a,"stroke-width",i.borderwidth),this.renderer.setStyle(a,"filter","url(#shadow)"),this.renderer.appendChild(l,a);let u=this.renderer.createElement("pattern","http://www.w3.org/2000/svg");this.renderer.setAttribute(u,"id","image-pattern"),this.renderer.setAttribute(u,"x","0%"),this.renderer.setAttribute(u,"y","0%"),this.renderer.setAttribute(u,"height","100%"),this.renderer.setAttribute(u,"width","100%"),this.renderer.setAttribute(u,"viewBox","0 0 100 100");let f=this.renderer.createElement("image","http://www.w3.org/2000/svg");this.renderer.setAttribute(f,"x","0"),this.renderer.setAttribute(f,"y","0"),this.renderer.setAttribute(f,"width","100"),this.renderer.setAttribute(f,"height","100"),this.renderer.setAttribute(f,"href",i.imageUrl),this.renderer.appendChild(u,f),this.renderer.appendChild(l,u);let v="Select "+i.type;this.requiredValues.push({defaultValue:v.toUpperCase(),type:i.type,value:i.imageUrl.trim()||"",id:c}),a.addEventListener("click",A=>{this.setImage(c)})}}),this.checkConditions(this.requiredValues)})}checkConditions(e){this.getDownload=!0;for(let t of e)if(t.type==="name"||t.type==="address"){if(t.value===""||t.value===t.defaultValue){this.getDownload=!1;break}}else if(t.type==="avatar"&&t.value==="assets/images/svg/upload-img.svg"){this.getDownload=!1;break}}getImageDataUrl(e){return V(this,null,function*(){try{let r=yield(yield fetch(e)).blob();return new Promise((o,d)=>{let l=new FileReader;l.onloadend=()=>o(l.result),l.onerror=d,l.readAsDataURL(r)})}catch(t){throw console.error("Error fetching or converting image:",t),t}})}textPosition(e){switch(e){case"center":return"middle";case"left":return"start";case"right":return"end";default:return"middle"}}checkTypeValues(e){let t=e.type,r=!0;switch(t){case"name":e.name=="name"&&this.setInput(e.name),r=!1;break;case"address":console.log("Processing address element");break;case"avatar":e.imageUrl&&this.setInput(e.name);break;default:console.log("Unknown element type");break}}setInput(e,t){}openImageCropperDialog(){let e=this.imageInput.nativeElement;e&&(e.click(),e.value=null),this.cropperModal.hide()}handleImageInputChange(e){let r=e.target.files?.[0];if(r&&(r.type==="image/jpeg"||r.type==="image/png")){let o=new FileReader;o.onload=d=>{let l=d.target?.result;this.cropperModal.show();let s=document.getElementById("cropper");this.cropper=new Cropper(s,{aspectRatio:1,scalable:!0,viewMode:3,crop:i=>{},autoCropArea:1,dragMode:"move",responsive:!0,cropBoxResizable:!1,minCropBoxWidth:320,minCropBoxHeight:320,minContainerWidth:320,minContainerHeight:320}),this.cropper.replace(l)},o.readAsDataURL(r)}}handleCropEvent(){if(this.cropper){let e=this.cropper.getCroppedCanvas(),t=document.createElement("canvas"),r=t.getContext("2d");t.width=200,t.height=200,r.drawImage(e,0,0,200,200);let o=t.toDataURL("image/png");this.profilePictureForm.get("image")?.setValue(o)}}setText(e){this.requiredValues.map(t=>{t.id===e&&(t.value!==t.defaultValue&&this.inputTextForm.get("text")?.setValue(t.value,{emitEvent:!1}),this.inputTextForm.get("id")?.setValue(t.id,{emitEvent:!1}),this.textModalTitle=t.defaultValue.toUpperCase(),this.textModal.show())})}setImage(e){this.requiredValues.map(t=>{t.id===e&&(this.profilePictureForm.get("image")?.setValue(t.value,{emitEvent:!1}),this.profilePictureForm.get("id")?.setValue(t.id,{emitEvent:!1}),this.imgModalTitle=t.defaultValue.toUpperCase(),this.cropperModal.show())})}onTextSubmit(){let e=this.inputTextForm.value;this.ele.elements.map(t=>{t.index==e.id&&(t.type=="name"||t.type=="address")&&(t.text=e.text,this.drawSVG(this.ele),this.textModal.hide())})}onImageSubmit(){this.handleCropEvent();let e=this.profilePictureForm.value;this.ele.elements.map(t=>{t.index==e.id&&t.type=="avatar"&&(t.imageUrl=e.image,this.drawSVG(this.ele),this.cropperModal.hide())})}getImageDataURL(){return V(this,null,function*(){let e=this.imageDraw.nativeElement,t=document.createElement("canvas"),r=t.getContext("2d");if(!r)return console.error("Canvas context is not available."),null;let d=(e.getAttribute("viewBox")||"").split(" ").map(Number),l=d[2],s=d[3];t.width=l,t.height=s;let i=new Image,a=new XMLSerializer().serializeToString(e);return new Promise((u,f)=>{i.onload=()=>{r.drawImage(i,0,0);let v=t.toDataURL("image/png");u(v)},i.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(a)))})})}capturePhoto(){let e=this.imageDraw.nativeElement,r=(e.getAttribute("viewBox")||"").split(" ").map(Number),o=r[2],d=r[3],l=document.createElement("canvas"),s=l.getContext("2d");l.width=o,l.height=d;let i=new Image,a=new XMLSerializer().serializeToString(e);i.onload=()=>{s?.drawImage(i,0,0);let u=l.toDataURL("image/png"),v=`IMG-${new Date().toISOString().replace(/:/g,"-")}.png`,A=document.createElement("a");A.href=u,A.download=v,A.click()},i.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(a)))}shareToWhatsApp(){return V(this,null,function*(){try{let e=yield this.getImageDataURL();if(e){let t="Check out this image!",r=window.location.href,o=`${t}
${r}`,d=`whatsapp://send?text=${encodeURIComponent(o)}&image=${encodeURIComponent(e)}`;window.open(d,"_blank")}else console.error("Failed to retrieve image data URL.")}catch(e){console.error("Error capturing photo:",e)}})}static{this.\u0275fac=function(t){return new(t||n)(S(ae),S(P),S(N),S(se),S(O))}}static{this.\u0275cmp=q({type:n,selectors:[["app-image-view"]],viewQuery:function(t,r){if(t&1&&(_(me,5),_(he,5),_(ge,5)),t&2){let o;T(o=D())&&(r.textInput=o.first),T(o=D())&&(r.imageDraw=o.first),T(o=D())&&(r.imageInput=o.first)}},decls:54,vars:8,consts:[["imageDraw",""],["textInput",""],["imageInput",""],[1,"h-100","d-flex","flex-column","p-3"],["href","https://www.facebook.com/SOJITRAHIREN","target","_blank",1,"btn","btn-primary","w-auto","mx-auto"],[1,"fa","fa-facebook","me-2"],[1,"flex-grow-1","position-relative","overflow-hidden"],["id","canvas-container",1,"position-absolute","h-100","w-100","text-center","d-flex","align-items-center","justify-content-center"],[1,"max-w-100","max-h-100"],[1,"mt-3","d-flex"],[1,"btn","btn-primary","mx-auto",3,"click","disabled"],[1,"fa","fa-download","me-2"],[1,"fa","fa-whatsapp","me-2"],["id","textModal","tabindex","-1","aria-labelledby","textModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],["id","textModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body","bg-dark"],[3,"ngSubmit","formGroup"],["type","text","formControlName","text",1,"form-control","form-control-lg","fw-bold"],["type","hidden","formControlName","id"],[1,"d-flex","mt-4"],[1,"btn","btn-primary","mx-auto",3,"disabled"],[1,"fa","fa-save"],["id","cropperModal","tabindex","-1","aria-labelledby","cropperModalLabel","aria-hidden","true",1,"modal","fade"],["id","cropperModalLabel",1,"modal-title"],[1,"modal-body"],["id","cropper","alt","Crop",1,"w-100",3,"src"],["type","file",2,"display","none",3,"change"],["type","hidden","formControlName","image"],["type","button",1,"btn","btn-success","mx-auto",3,"click"],[1,"fa","fa-refresh"]],template:function(t,r){if(t&1){let o=z();m(0,"div",3)(1,"a",4),p(2,"i",5),w(3,"Hiren Sojitra"),g(),p(4,"hr"),m(5,"div",6)(6,"div",7),L(),p(7,"svg",8,0),g()(),$(),p(9,"hr"),m(10,"div",9)(11,"button",10),I("click",function(){return x(o),C(r.capturePhoto())}),p(12,"i",11),w(13,"Download "),g(),m(14,"button",10),I("click",function(){return x(o),C(r.shareToWhatsApp())}),p(15,"i",12),w(16," Share To WhatsApp "),g()()(),m(17,"div",13)(18,"div",14)(19,"div",15)(20,"div",16)(21,"h5",17),w(22),g(),p(23,"button",18),g(),m(24,"div",19)(25,"form",20),I("ngSubmit",function(){return x(o),C(r.onTextSubmit())}),p(26,"input",21,1)(28,"input",22),m(29,"div",23)(30,"button",24),p(31,"i",25),w(32," Save"),g()()()()()()(),m(33,"div",26)(34,"div",14)(35,"div",15)(36,"div",16)(37,"h5",27),w(38,"Profile Photo"),g(),p(39,"button",18),g(),m(40,"div",28),p(41,"img",29),m(42,"input",30,2),I("change",function(l){return x(o),C(r.handleImageInputChange(l))}),g(),m(44,"form",20),I("ngSubmit",function(){return x(o),C(r.onImageSubmit())}),p(45,"input",22)(46,"input",31),m(47,"div",23)(48,"button",32),I("click",function(){return x(o),C(r.openImageCropperDialog())}),p(49,"i",33),w(50," Change Photo"),g(),m(51,"button",24),p(52,"i",25),w(53," Save"),g()()()()()()()}if(t&2){let o;b(11),y("disabled",!r.getDownload),b(3),y("disabled",!r.getDownload),b(8),H("",r.textModalTitle," [\u0A97\u0AC1\u0A9C\u0AB0\u0ABE\u0AA4\u0AC0\u0AAE\u0ABE\u0A82]"),b(3),y("formGroup",r.inputTextForm),b(5),y("disabled",r.inputTextForm.invalid),b(11),y("src",(o=r.profilePictureForm.get("image"))==null?null:o.value,j),b(3),y("formGroup",r.profilePictureForm),b(7),y("disabled",r.profilePictureForm.invalid)}},dependencies:[Z,Y,J,K,ee,te]})}}return n})();var fe=[{path:"",component:ne,data:{title:"Image View",breadcrumb:"Image View"}}],le=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=U({type:n})}static{this.\u0275inj=k({imports:[G.forChild(fe),G]})}}return n})();var _e=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=U({type:n})}static{this.\u0275inj=k({imports:[Q,le,ie,oe]})}}return n})();export{_e as ImageViewModule};
