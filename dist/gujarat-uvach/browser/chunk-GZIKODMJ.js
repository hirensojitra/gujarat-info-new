import{a as L}from"./chunk-VNRO2UAE.js";import{a as j}from"./chunk-QBWMG5PC.js";import{a as q}from"./chunk-YRYSSATH.js";import{a as D,r as W}from"./chunk-LC4MWVDC.js";import{b as N,f as $,j as z,x as A,y as Q}from"./chunk-637AZWOF.js";import{a as X}from"./chunk-NLE7UQJM.js";import"./chunk-64FAQS26.js";import"./chunk-TF3KVUAE.js";import{a as T}from"./chunk-77ITHIYP.js";import{Aa as d,Da as M,E as x,Ea as P,Fa as k,Ha as m,J as S,Ja as w,K as b,Kb as y,La as R,Ma as O,Na as E,P as p,Q as u,Z as U,aa as l,ba as v,fb as V,gb as F,la as C,na as a,nb as I,ta as r,ua as s,va as c,ya as f,za as g}from"./chunk-6SCNQMZS.js";import"./chunk-CWTPBX7D.js";var J=["rolesModal"];function K(i,h){if(i&1){let e=f();r(0,"a",35),g("click",function(){p(e);let o=d().$implicit,n=d();return u(n.sendMail(o.email))}),r(1,"small"),c(2,"i",36),s()()}i&2&&a("hPX",30)("wPX",30)}function Y(i,h){if(i&1){let e=f();r(0,"a",35),g("click",function(){p(e);let o=d().$implicit,n=d();return u(n.makeCall(o.mobile))}),r(1,"small"),c(2,"i",37),s()()}i&2&&a("hPX",30)("wPX",30)}function Z(i,h){if(i&1){let e=f();r(0,"div",17)(1,"div",18)(2,"div",19),c(3,"img",20),r(4,"div",21)(5,"h5",22),m(6),s(),r(7,"small",23)(8,"i"),m(9),s()()(),c(10,"hr",24),r(11,"div",25),C(12,K,3,2,"a",26)(13,Y,3,2,"a",26),s()(),r(14,"div",27)(15,"a",28),g("click",function(o){let n=p(e).$implicit;return d().openRolesModal(n),u(o.preventDefault())}),c(16,"i",29),s(),r(17,"div",30)(18,"a",31),g("click",function(o){let n=p(e).$implicit;return d().openRolesModal(n),u(o.preventDefault())}),c(19,"i",29),s(),c(20,"div",32),r(21,"a",33),c(22,"i",34),m(23," Delete "),s()()()()()}if(i&2){let e=h.$implicit,t=d();l(3),a("src",t.validateImage(e.username),U)("alt",e.firstname?e.firstname+" "+e.lastname:"User")("wPX",60)("hPX",60),l(2),a("title",e.fullname),l(),w(" ",e.fullname,""),l(),a("title",e.username),l(2),w("@",e.username,""),l(3),a("ngIf",e.email),l(),a("ngIf",e.mobile)}}function ee(i,h){if(i&1){let e=f();r(0,"div",38)(1,"input",39),E("ngModelChange",function(o){let n=p(e).$implicit,_=d();return O(_.selectedRoles[n],o)||(_.selectedRoles[n]=o),u(o)}),s(),r(2,"label",40),m(3),s()()}if(i&2){let e=h.$implicit,t=d();l(),a("id","role-"+(t.selectedUser==null?null:t.selectedUser._id)+"-"+e),R("ngModel",t.selectedRoles[e]),l(),a("for","role-"+(t.selectedUser==null?null:t.selectedUser._id)+"-"+e),l(),w(" ",e," ")}}var G=(()=>{class i{changePageSize(e){this.limit=e,this.currentPage=1,this.loadUsers()}constructor(e,t,o,n){this.userService=e,this.toastService=t,this.DS=o,this.authService=n,this.users=[],this.pagination={},this.currentPage=1,this.limit=10,this.availableRoles=["master","admin","moderator","curator","poster creator","premium user","free user","guest","user"],this.selectedUser=null,this.selectedRoles={},this.apiUrl=T.MasterApi+"/auth/profile-image/"}ngOnInit(){this.loadUsers()}loadUsers(e=this.currentPage){this.userService.getAllUsers({page:e,limit:this.limit}).subscribe(t=>{this.users=t.users,this.pagination=t.pagination,this.currentPage=t.pagination.currentPage},t=>{this.toastService.show(t.error.error,{class:"bg-danger",title:"Error fetching users:"})})}changePage(e){this.loadUsers(e)}updateUserRole(e,t){confirm(`Are you sure you want to assign the role "${t}" to this user? ${e}`)&&this.userService.updateUser(e,{roles:t}).subscribe(o=>{this.toastService.show("User role updated successfully!",{class:"bg-success",title:"Success:"}),this.loadUsers()},o=>{this.toastService.show(o.error.error,{class:"bg-danger",title:"Error updating role:"})})}validateImage(e){return e?`${this.apiUrl+e}?format=png&quality=10`:"https://dummyimage.com/300x300/F4F4F4/000000&text=USER"}makeCall(e){return this.DS.makeCall(e),!1}sendMail(e,t="",o=""){return this.DS.sendMail(e,t,o),!1}openRolesModal(e){if(!this.authService.hasRole(["master"])){this.toastService.show("Only master users can modify roles",{class:"bg-danger",title:"Permission Denied"});return}this.selectedUser=e,this.availableRoles.forEach(t=>{this.selectedRoles[t]=e.roles.includes(t)}),this.modal=new bootstrap.Modal(this.rolesModal.nativeElement),this.modal.show()}updateRoles(){let e=this.availableRoles.filter(t=>this.selectedRoles[t]);confirm(`Update roles for ${this.selectedUser.fullname}?`)&&(console.log(this.selectedUser),this.userService.updateUser(this.selectedUser.id,{roles:e.join(", ")}).subscribe({next:t=>{this.selectedUser.roles=e,this.toastService.show("Roles updated successfully!",{class:"bg-success",title:"Success"}),this.modal.hide()},error:t=>{this.toastService.show(t.error.error,{class:"bg-danger",title:"Update Failed"})}}))}static{this.\u0275fac=function(t){return new(t||i)(v(j),v(q),v(L),v(X))}}static{this.\u0275cmp=S({type:i,selectors:[["app-users"]],viewQuery:function(t,o){if(t&1&&M(J,5),t&2){let n;P(n=k())&&(o.rolesModal=n.first)}},decls:20,vars:3,consts:[["rolesModal",""],[1,"h-100","w-100","d-flex","flex-column"],[1,"flex-grow-1","overflow-y-auto","position-relative"],[1,"position-absolute","h-100","w-100","p-3"],[1,"row","g-3","align-items-stretch"],["class","col-md-4 col-sm-6 col-lg-4 col-xl-3 col-xxl-2 col-6",4,"ngFor","ngForOf"],["tabindex","-1",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal",1,"btn-close"],[1,"modal-body"],["class","form-check",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary",3,"click"],[1,"col-md-4","col-sm-6","col-lg-4","col-xl-3","col-xxl-2","col-6"],[1,"profile-widget","p-3","h-100","bg-white","d-flex","flex-column","rounded-3","border"],[1,"flex-grow-1","d-flex","align-items-center","flex-column"],["remSize","",1,"rounded-2","border-2","shadow","border","border-white","mx-auto","mb-3",3,"src","alt","wPX","hPX"],[1,"text-center"],[1,"text-truncate","fw-bold","mb-0","text-dark",3,"title"],[1,"text-truncate","m-0",3,"title"],[1,"border-dark","w-75"],[1,"d-flex","align-items-center"],["href","#","class","btn btn-outline-secondary rounded-0 btn-sm m-1 p-0 d-flex align-items-center justify-content-center","remSize","","type","button",3,"hPX","wPX","click",4,"ngIf"],[1,"dropdown","profile-action","h-100","d-flex","align-items-start"],["href","#",1,"action-icon",3,"click"],[1,"fa","fa-shield","me-2"],[1,"dropdown-menu","dropdown-menu-right"],["href","#",1,"dropdown-item",3,"click"],[1,"dropdown-divider"],["href","#","data-bs-toggle","modal","data-bs-target","#delete_employee",1,"dropdown-item"],[1,"fa","fa-trash","me-2"],["href","#","remSize","","type","button",1,"btn","btn-outline-secondary","rounded-0","btn-sm","m-1","p-0","d-flex","align-items-center","justify-content-center",3,"click","hPX","wPX"],[1,"fa","fa-envelope","text-center"],[1,"fa","fa-phone","text-center"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"ngModelChange","id","ngModel"],[1,"form-check-label",3,"for"]],template:function(t,o){if(t&1){let n=f();r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),C(4,Z,24,10,"div",5),s()()()(),r(5,"div",6,0)(7,"div",7)(8,"div",8)(9,"div",9)(10,"h5",10),m(11),s(),c(12,"button",11),s(),r(13,"div",12),C(14,ee,4,4,"div",13),s(),r(15,"div",14)(16,"button",15),m(17,"Cancel"),s(),r(18,"button",16),g("click",function(){return p(n),u(o.updateRoles())}),m(19,"Save Changes"),s()()()()()}t&2&&(l(4),a("ngForOf",o.users),l(7),w("Edit Roles for ",o.selectedUser==null?null:o.selectedUser.fullname,""),l(3),a("ngForOf",o.availableRoles))},dependencies:[V,F,N,$,z,D],styles:[".profile-widget[_ngcontent-%COMP%]{position:relative}.profile-widget[_ngcontent-%COMP%]   .dropdown.profile-action[_ngcontent-%COMP%]{text-align:right;position:absolute;top:0;right:0;padding-right:10px;padding-top:10px;pointer-events:none}.profile-widget[_ngcontent-%COMP%]   .dropdown.profile-action[_ngcontent-%COMP%]   .action-icon[_ngcontent-%COMP%]{color:var(--bs-secondary-600);font-size:var(--bs-font-size-18);display:inline-block;pointer-events:auto}.profile-widget[_ngcontent-%COMP%]   .dropdown.profile-action[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]{pointer-events:auto}.profile-widget[_ngcontent-%COMP%]   .dropdown.profile-action[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.profile-widget[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%], .profile-widget[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--bs-secondary-900)}"]})}}return i})();var te=[{path:"",component:G,data:{title:"PostNew | Authentication",description:"Login or register to PostNew portal for accessing services",keywords:"PostNew, login, register, authentication, portal",robots:"index, follow"}}],H=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=b({type:i})}static{this.\u0275inj=x({imports:[y.forChild(te),y]})}}return i})();var xe=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=b({type:i})}static{this.\u0275inj=x({imports:[I,H,A,Q,W]})}}return i})();export{xe as UsersModule};
