import{a as m}from"./chunk-I4RV6RFQ.js";import{a as n}from"./chunk-32SRTGJU.js";import{a as d,c as k,u as f}from"./chunk-UO3RAHZO.js";import{M as r,d as l,fa as u,ka as s,t as p,u as h,z as c}from"./chunk-NIQGYGOG.js";var y=(()=>{class i{constructor(e,t,o){this.http=e,this.cookieService=t,this.router=o,this.apiUrl=n.MasterApi+"/auth",this.cookieOptions={path:"/",secure:n.production,sameSite:"Strict",httpOnly:!1}}loginUser(e,t){return this.http.post(`${this.apiUrl}/login`,{username:e,password:t}).pipe(r(this.handleError))}setToken(e){this.cookieService.set("token",e,{path:"/",secure:!1})}getToken(){return this.cookieService.get("token")||null}isAuthenticated(){return this.getToken()?this.validateTokenInternal().pipe(c(()=>!0),r(()=>p(!1))):new l(t=>t.next(!1))}hasRole(e){try{let t=this.getUserData();if(!t?.roles)return!1;let o=Array.isArray(t.roles)?t.roles:t.roles.split(",").map(a=>a.trim());return e.some(a=>o.includes(a))}catch(t){return console.error("Role check failed:",t),!1}}getUserData(){let e=this.cookieService.get("user");if(!e)return null;try{return JSON.parse(e)}catch(t){return console.error("Invalid user data:",t),null}}resendVerificationEmail(e){return this.http.post(`${this.apiUrl}/resend-verification`,{email:e}).pipe(r(this.handleError))}handleError(e){let t=e.error?.message||"An unexpected error occurred";return h(()=>new Error(t))}validateToken(){return this.getToken()?this.validateTokenInternal():h(()=>new Error("No authentication token available"))}validateTokenInternal(){let e=new d({Authorization:`Bearer ${this.getToken()}`});return this.http.post(`${n.MasterApi}/validate-token`,{},{headers:e}).pipe(r(this.handleError))}logout(){["token","user"].forEach(e=>this.cookieService.delete(e,this.cookieOptions.path)),this.router.navigate(["/login"])}requestPasswordReset(e){return this.http.post(`${this.apiUrl}/forgot-password`,{email:e}).pipe(r(this.handleError))}resetPassword(e,t,o){return this.http.post(`${this.apiUrl}/reset-password`,{token:e,email:t,password:o}).pipe(r(this.handleError))}validateResetToken(e,t){return this.http.post(`${this.apiUrl}/validate-reset-token`,{token:e,email:t}).pipe(r(this.handleError))}static{this.\u0275fac=function(t){return new(t||i)(s(k),s(m),s(f))}}static{this.\u0275prov=u({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{y as a};
