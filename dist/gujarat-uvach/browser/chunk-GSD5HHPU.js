import{a as C}from"./chunk-JRGTDWPY.js";import{a as w}from"./chunk-TNJ6SPRJ.js";import"./chunk-SQRP6PMK.js";import{a as P}from"./chunk-YRG5W6VS.js";import"./chunk-7YVPWAOW.js";import"./chunk-RWKAEW2Z.js";import"./chunk-WIB4C2YZ.js";import{s as E,w as k}from"./chunk-KB4EY57F.js";import{$b as v,Db as u,Fb as s,Qb as o,Rb as n,Zb as h,kb as a,kc as c,la as d,lb as m,lc as g,ld as T,mc as S,va as _,wa as p,wd as y}from"./chunk-YECJCXI6.js";import{a as b,b as x}from"./chunk-CWTPBX7D.js";function F(e,l){if(e&1&&(o(0,"th"),c(1),n()),e&2){let i=l.$implicit;a(),g(i)}}function I(e,l){if(e&1&&(o(0,"td"),c(1),n()),e&2){let i=l.$implicit,t=v().$implicit;a(),g(t[i])}}function j(e,l){if(e&1&&(o(0,"tr"),u(1,I,2,1,"td",9),n()),e&2){let i=v();a(),s("ngForOf",i.tableHeaders)}}var R=(()=>{class e{constructor(i,t,r,f){this.route=i,this.trackService=t,this.authService=r,this.roleService=f,this.imgParam=null,this.trackedData=[],this.tableHeaders=[],this.user=null,this.roles=[],this.userRole=null}ngOnInit(){this.imgParam=this.route.snapshot.paramMap.get("imgParam"),this.user=this.authService.getUser(),this.roleService.getRoles().subscribe(i=>{if(this.roles=i,this.user){let t=this.roles.find(r=>r.id===this.user?.role_id);this.userRole=t?t.code:null}}),this.imgParam&&this.trackService.getTrackData(this.imgParam).subscribe(i=>{this.trackedData=i.map(t=>{let r=typeof t.value_data=="string"?JSON.parse(t.value_data):t.value_data;return x(b({},r),{timestamp:t.timestamp})}),this.trackedData.length>0&&(this.tableHeaders=Object.keys(this.trackedData[0]))})}canExport(){return this.userRole==="OWNER"||this.userRole==="ADMINISTRATOR"}exportExcel(){this.imgParam&&this.trackService.generateExcel(this.imgParam).subscribe(i=>{this.trackService.downloadFile(i,`${this.imgParam}.xlsx`,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")})}exportPdf(){this.imgParam&&this.trackService.generatePdf(this.imgParam).subscribe(i=>{this.trackService.downloadFile(i,`${this.imgParam}.pdf`,"application/pdf")})}static{this.\u0275fac=function(t){return new(t||e)(m(E),m(C),m(P),m(w))}}static{this.\u0275cmp=_({type:e,selectors:[["app-track-view"]],decls:18,vars:5,consts:[[1,"container-fluid"],[1,"card"],[1,"card-header"],[1,"d-flex","justify-content-end"],[1,"btn","btn-primary","me-2",3,"click","disabled"],[1,"btn","btn-primary",3,"click","disabled"],[1,"card-body"],[1,"table-responsive"],[1,"table","table-striped"],[4,"ngFor","ngForOf"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),c(4),n(),o(5,"div",3)(6,"button",4),h("click",function(){return r.exportExcel()}),c(7,"Export to Excel"),n(),o(8,"button",5),h("click",function(){return r.exportPdf()}),c(9,"Export to PDF"),n()()(),o(10,"div",6)(11,"div",7)(12,"table",8)(13,"thead")(14,"tr"),u(15,F,2,1,"th",9),n()(),o(16,"tbody"),u(17,j,2,1,"tr",9),n()()()()()()),t&2&&(a(4),S("Tracked Data for: ",r.imgParam,""),a(2),s("disabled",!r.canExport()),a(2),s("disabled",!r.canExport()),a(7),s("ngForOf",r.tableHeaders),a(2),s("ngForOf",r.trackedData))},dependencies:[T]})}}return e})();var O=[{path:":imgParam",component:R}],D=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=p({type:e})}static{this.\u0275inj=d({imports:[k.forChild(O),k]})}}return e})();var Q=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=p({type:e})}static{this.\u0275inj=d({imports:[y,D]})}}return e})();export{Q as TrackModule};
